
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Reducing Failure-Inducing Inputs &#8212; The Fuzzing Book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=42e1b1a5" />
    <link rel="stylesheet" type="text/css" href="_static/mastodon-timeline.css?v=f82c2b23" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Reducer';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Fuzzing with Constraints" href="FuzzingWithConstraints.html" />
    <link rel="prev" title="Greybox Fuzzing with Grammars" href="GreyboxGrammarFuzzer.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content"><p>This is a beta version of fuzzingbook.org, currently in development. See the <a href="https://fuzzingbook.org/"  style="color:white!important;">classic site</a> for resources.</p></div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/fuzzingbook.png" class="logo__image only-light" alt="The Fuzzing Book - Home"/>
    <script>document.write(`<img src="_static/fuzzingbook.png" class="logo__image only-dark" alt="The Fuzzing Book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="index.html">
                    The Fuzzing Book
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Tours.html">Tours through the Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="Intro_Testing.html">Introduction to Software Testing</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Lexical Fuzzing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Fuzzer.html">Fuzzing: Breaking Things with Random Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="Coverage.html">Code Coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="MutationFuzzer.html">Mutation-Based Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="GreyboxFuzzer.html">Greybox Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="SearchBasedFuzzer.html">Search-Based Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="MutationAnalysis.html">Mutation Analysis</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Syntactical Fuzzing</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Grammars.html">Fuzzing with Grammars</a></li>
<li class="toctree-l1"><a class="reference internal" href="GrammarFuzzer.html">Efficient Grammar Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="GrammarCoverageFuzzer.html">Grammar Coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="Parser.html">Parsing Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="ProbabilisticGrammarFuzzer.html">Probabilistic Grammar Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="GeneratorGrammarFuzzer.html">Fuzzing with Generators</a></li>

<li class="toctree-l1"><a class="reference internal" href="GreyboxGrammarFuzzer.html">Greybox Fuzzing with Grammars</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Reducing Failure-Inducing Inputs</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Semantical Fuzzing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="FuzzingWithConstraints.html">Fuzzing with Constraints</a></li>
<li class="toctree-l1"><a class="reference internal" href="GrammarMiner.html">Mining Input Grammars</a></li>
<li class="toctree-l1"><a class="reference internal" href="InformationFlow.html">Tracking Information Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="ConcolicFuzzer.html">Concolic Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="SymbolicFuzzer.html">Symbolic Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="DynamicInvariants.html">Mining Function Specifications</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Domain-Specific Fuzzing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ConfigurationFuzzer.html">Testing Configurations</a></li>
<li class="toctree-l1"><a class="reference internal" href="APIFuzzer.html">Fuzzing APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="Carver.html">Carving Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="PythonFuzzer.html">Testing Compilers</a></li>
<li class="toctree-l1"><a class="reference internal" href="WebFuzzer.html">Testing Web Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="GUIFuzzer.html">Testing Graphical User Interfaces</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Managing Fuzzing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="FuzzingInTheLarge.html">Fuzzing in the Large</a></li>
<li class="toctree-l1"><a class="reference internal" href="WhenToStopFuzzing.html">When To Stop Fuzzing</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="AcademicPrototyping.html">Academic Prototyping</a></li>
<li class="toctree-l1"><a class="reference internal" href="PrototypingWithPython.html">Prototyping with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="ExpectError.html">Error Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="Timer.html">Timer</a></li>
<li class="toctree-l1"><a class="reference internal" href="Timeout.html">Timeout</a></li>
<li class="toctree-l1"><a class="reference internal" href="ClassDiagram.html">Class Diagrams</a></li>
<li class="toctree-l1"><a class="reference internal" href="RailroadDiagrams.html">Railroad Diagrams</a></li>
<li class="toctree-l1"><a class="reference internal" href="ControlFlow.html">Control Flow Graph</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">About This Book</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ReleaseNotes.html">Fuzzingbook Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="Importing.html">Using Fuzzingbook Code in your own Programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="Guide_for_Authors.html">Guide for Authors</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?urlpath=tree/docs/notebooks/Reducer.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/uds-se/fuzzingbook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/uds-se/fuzzingbook/issues/new?title=Issue%20on%20page%20%2FReducer.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Reducer.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Reducing Failure-Inducing Inputs</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synopsis">Synopsis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-reducing">Why Reducing?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-input-reduction">Manual Input Reduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#delta-debugging">Delta Debugging</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#grammar-based-input-reduction">Grammar-Based Input Reduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lexical-reduction-vs-syntactic-rules">Lexical Reduction vs. Syntactic Rules</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-grammar-based-reduction-approach">A Grammar-Based Reduction Approach</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simplifying-by-replacing-subtrees">Simplifying by Replacing Subtrees</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simplifying-by-alternative-expansions">Simplifying by Alternative Expansions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#excursion-a-class-for-reducing-with-grammars">Excursion: A Class for Reducing with Grammars</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#a-few-helpers">A Few Helpers</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#simplification-strategies">Simplification Strategies</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-subtrees">Finding Subtrees</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#alternate-expansions">Alternate Expansions</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#both-strategies-together">Both Strategies Together</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-reduction-strategy">The Reduction Strategy</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#end-of-excursion">End of Excursion</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-depth-oriented-strategy">A Depth-Oriented Strategy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-strategies">Comparing Strategies</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Synopsis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lessons-learned">Lessons Learned</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next Steps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-mutation-based-fuzzing-with-reduction">Exercise 1: Mutation-Based Fuzzing with Reduction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-reduction-by-production">Exercise 2: Reduction by Production</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-3-the-big-reduction-shoot-out">Exercise 3: The Big Reduction Shoot-Out</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="reducing-failure-inducing-inputs">
<h1>Reducing Failure-Inducing Inputs<a class="headerlink" href="#reducing-failure-inducing-inputs" title="Link to this heading">#</a></h1>
<p>By construction, fuzzers create inputs that may be hard to read.  This causes issues during <em>debugging</em>, when a human has to analyze the exact cause of the failure.  In this chapter, we present techniques that <em>automatically reduce and simplify failure-inducing inputs to a minimum</em> in order to ease debugging.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bookutils</span> <span class="kn">import</span> <span class="n">YouTubeVideo</span>
<span class="n">YouTubeVideo</span><span class="p">(</span><span class="s1">&#39;JOv1xGVdXAU&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
        <iframe
            width="640"
            height="360"
            src="https://www.youtube-nocookie.com/embed/JOv1xGVdXAU"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
<p><strong>Prerequisites</strong></p>
<ul class="simple">
<li><p>The simple “delta debugging” technique for reduction has no specific prerequisites.</p></li>
<li><p>As reduction is typically used together with fuzzing, reading the <a class="reference internal" href="Fuzzer.html"><span class="std std-doc">chapter on basic fuzzing</span></a> is a good idea.</p></li>
<li><p>The later grammar-based techniques require knowledge on <a class="reference internal" href="GrammarFuzzer.html"><span class="std std-doc">derivation trees</span></a> and <a class="reference internal" href="Parser.html"><span class="std std-doc">parsing</span></a>.</p></li>
</ul>
<section id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Link to this heading">#</a></h2>
<!-- Automatically generated. Do not edit. -->
<p>To <a class="reference internal" href="Importing.html"><span class="std std-doc">use the code provided in this chapter</span></a>, write</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">fuzzingbook.Reducer</span> <span class="kn">import</span> <span class="o">&lt;</span><span class="n">identifier</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>and then make use of the following features.</p>
<p>A <em>reducer</em> takes a failure-inducing input and reduces it to the minimum that still reproduces the failure.  This chapter provides <code class="docutils literal notranslate"><span class="pre">Reducer</span></code> classes that implement such reducers.</p>
<p>Here is a simple example: An arithmetic expression causes an error in the Python interpreter:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="err">!</span><span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;x = 1 + 2 * 3 / 0&#39;</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;string&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">ZeroDivisionError</span>: <span class="n">division by zero</span>

</pre></div>
</div>
<p>Can we reduce this input to a minimum?  To use a <code class="docutils literal notranslate"><span class="pre">Reducer</span></code>, one first has to build a <code class="docutils literal notranslate"><span class="pre">Runner</span></code> whose outcome is <code class="docutils literal notranslate"><span class="pre">FAIL</span></code> if the precise error occurs.  We therefore build a <code class="docutils literal notranslate"><span class="pre">ZeroDivisionRunner</span></code> whose <code class="docutils literal notranslate"><span class="pre">run()</span></code> method will specifically return a <code class="docutils literal notranslate"><span class="pre">FAIL</span></code> outcome if a <code class="docutils literal notranslate"><span class="pre">ZeroDivisionError</span></code> occurs.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">Fuzzer</span> <span class="kn">import</span> <span class="n">ProgramRunner</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">ZeroDivisionRunner</span><span class="p">(</span><span class="n">ProgramRunner</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Make outcome &#39;FAIL&#39; if ZeroDivisionError occurs&quot;&quot;&quot;</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">subprocess</span><span class="o">.</span><span class="n">CompletedProcess</span><span class="p">,</span> <span class="n">Outcome</span><span class="p">]:</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="n">process</span><span class="p">,</span> <span class="n">outcome</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;ZeroDivisionError&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>            <span class="n">outcome</span> <span class="o">=</span> <span class="s1">&#39;FAIL&#39;</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="k">return</span> <span class="n">process</span><span class="p">,</span> <span class="n">outcome</span>
</pre></div>
</div>
<p>If we feed this expression into a <code class="docutils literal notranslate"><span class="pre">ZeroDivisionRunner</span></code>, it will produce an outcome of <code class="docutils literal notranslate"><span class="pre">FAIL</span></code> as designed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">python_input</span> <span class="o">=</span> <span class="s2">&quot;x = 1 + 2 * 3 / 0&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">python_runner</span> <span class="o">=</span> <span class="n">ZeroDivisionRunner</span><span class="p">(</span><span class="s2">&quot;python&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">process</span><span class="p">,</span> <span class="n">outcome</span> <span class="o">=</span> <span class="n">python_runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">python_input</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">outcome</span>
<span class="go">&#39;FAIL&#39;</span>
</pre></div>
</div>
<p>Delta Debugging is a simple and robust reduction algorithm.  We can tie a <code class="docutils literal notranslate"><span class="pre">DeltaDebuggingReducer</span></code> to this runner, and have it determine the substring that causes the <code class="docutils literal notranslate"><span class="pre">python</span></code> program to fail:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dd</span> <span class="o">=</span> <span class="n">DeltaDebuggingReducer</span><span class="p">(</span><span class="n">python_runner</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dd</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">python_input</span><span class="p">)</span>
<span class="go">&#39;3/0&#39;</span>
</pre></div>
</div>
<p>The input is reduced to the minimum: We get the essence of the division by zero.</p>
<p><img alt="" src="_images/Reducer-synopsis-1.svg" /></p>
</section>
<section id="why-reducing">
<h2>Why Reducing?<a class="headerlink" href="#why-reducing" title="Link to this heading">#</a></h2>
<p>At this point, we have seen a number of test generation techniques that all in some form produce inputs in order to trigger failures.  If they are successful – that is, the program actually fails – we must find out why the failure occurred and how to fix it.</p>
<p>Here’s an example of such a situation.  We have a class <code class="docutils literal notranslate"><span class="pre">MysteryRunner</span></code> with a <code class="docutils literal notranslate"><span class="pre">run()</span></code> method that – given its code – can occasionally fail.  But under which circumstances does this actually happen?  We have deliberately obscured the exact condition in order to make this non-obvious.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bookutils.setup</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bookutils</span> <span class="kn">import</span> <span class="n">quiz</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ExpectError</span> <span class="kn">import</span> <span class="n">ExpectError</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Fuzzer</span> <span class="kn">import</span> <span class="n">RandomFuzzer</span><span class="p">,</span> <span class="n">Runner</span><span class="p">,</span> <span class="n">Outcome</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MysteryRunner</span><span class="p">(</span><span class="n">Runner</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Outcome</span><span class="p">]:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mo">0o17</span> <span class="o">+</span> <span class="mo">0o31</span><span class="p">))</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mo">0o27</span> <span class="o">+</span> <span class="mo">0o22</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">Runner</span><span class="o">.</span><span class="n">FAIL</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">Runner</span><span class="o">.</span><span class="n">PASS</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let us fuzz the function until we find a failing input.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mystery</span> <span class="o">=</span> <span class="n">MysteryRunner</span><span class="p">()</span>
<span class="n">random_fuzzer</span> <span class="o">=</span> <span class="n">RandomFuzzer</span><span class="p">()</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">inp</span> <span class="o">=</span> <span class="n">random_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
    <span class="n">result</span><span class="p">,</span> <span class="n">outcome</span> <span class="o">=</span> <span class="n">mystery</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">outcome</span> <span class="o">==</span> <span class="n">mystery</span><span class="o">.</span><span class="n">FAIL</span><span class="p">:</span>
        <span class="k">break</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">failing_input</span> <span class="o">=</span> <span class="n">result</span>
<span class="n">failing_input</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39; 7:,&gt;((/$$-/-&gt;.;.=;(.%!:50#7*8=$&amp;&amp;=$9!%6(4=&amp;69\&#39;:\&#39;&lt;3+0-3.24#7=!&amp;60)2/+&quot;;+&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5\&#39;\&#39;&gt;#&#39;
</pre></div>
</div>
</div>
</div>
<p>Something in this input causes <code class="docutils literal notranslate"><span class="pre">MysteryRunner</span></code> to fail.  But what is it?</p>
</section>
<section id="manual-input-reduction">
<h2>Manual Input Reduction<a class="headerlink" href="#manual-input-reduction" title="Link to this heading">#</a></h2>
<p>One important step in the debugging process is <em>reduction</em> – that is, to identify those circumstances of a failure that are relevant for the failure to occur, and to <em>omit</em> (if possible) those parts that are not.  As Kernighan and Pike \cite{Kernighan1999} put it:</p>
<blockquote>
<div><p>For every circumstance of the problem, check whether it is relevant for the problem to occur.  If it is not, remove it from the problem report or the test case in question.</p>
</div></blockquote>
<p>Specifically for inputs, they suggest a <em>divide and conquer</em> process:</p>
<blockquote>
<div><p>Proceed by binary search.  Throw away half the input and see if the output is still wrong; if not, go back to the previous state and discard the other half of the input.</p>
</div></blockquote>
<p>This is something we can easily try out, using our last generated input:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">failing_input</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39; 7:,&gt;((/$$-/-&gt;.;.=;(.%!:50#7*8=$&amp;&amp;=$9!%6(4=&amp;69\&#39;:\&#39;&lt;3+0-3.24#7=!&amp;60)2/+&quot;;+&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5\&#39;\&#39;&gt;#&#39;
</pre></div>
</div>
</div>
</div>
<p>For instance, we can see whether the error still occurs if we only feed in the first half:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">half_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">failing_input</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>   <span class="c1"># // is integer division</span>
<span class="n">first_half</span> <span class="o">=</span> <span class="n">failing_input</span><span class="p">[:</span><span class="n">half_length</span><span class="p">]</span>
<span class="n">mystery</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">first_half</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&quot; 7:,&gt;((/$$-/-&gt;.;.=;(.%!:50#7*8=$&amp;&amp;=$9!%6(4=&amp;69&#39;:&quot;, &#39;PASS&#39;)
</pre></div>
</div>
</div>
</div>
<p>Nope – the first half alone does not suffice.  Maybe the second half?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">second_half</span> <span class="o">=</span> <span class="n">failing_input</span><span class="p">[</span><span class="n">half_length</span><span class="p">:]</span>
<span class="n">mystery</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">second_half</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;\&#39;&lt;3+0-3.24#7=!&amp;60)2/+&quot;;+&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5\&#39;\&#39;&gt;#&#39;, &#39;PASS&#39;)
</pre></div>
</div>
</div>
</div>
<p>This did not go so well either.  We may still proceed by cutting away <em>smaller chunks</em> – say, one character after another.  If our test is deterministic and easily repeated, it is clear that this process eventually will yield a reduced input.  But still, it is a rather inefficient process, especially for long inputs.  What we need is a <em>strategy</em> that effectively minimizes a failure-inducing input – a strategy that can be automated.</p>
</section>
<section id="delta-debugging">
<h2>Delta Debugging<a class="headerlink" href="#delta-debugging" title="Link to this heading">#</a></h2>
<p>One strategy to effectively reduce failure-inducing inputs is <em>delta debugging</em> \cite{Zeller2002}.  Delta Debugging implements the “binary search” strategy, as listed above, but with a twist: If neither half fails (also as above), it keeps on cutting away smaller and smaller chunks from the input, until it eliminates individual characters.  Thus, after cutting away the first half, we cut away
the first quarter, the second quarter, and so on.</p>
<p>Let us illustrate this on our example, and see what happens if we cut away the first quarter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quarter_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">failing_input</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span>
<span class="n">input_without_first_quarter</span> <span class="o">=</span> <span class="n">failing_input</span><span class="p">[</span><span class="n">quarter_length</span><span class="p">:]</span>
<span class="n">mystery</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">input_without_first_quarter</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;50#7*8=$&amp;&amp;=$9!%6(4=&amp;69\&#39;:\&#39;&lt;3+0-3.24#7=!&amp;60)2/+&quot;;+&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5\&#39;\&#39;&gt;#&#39;,
 &#39;FAIL&#39;)
</pre></div>
</div>
</div>
</div>
<p>Ah! This has failed, and reduced our failing input by 25%.  Let’s remove another quarter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">input_without_first_and_second_quarter</span> <span class="o">=</span> <span class="n">failing_input</span><span class="p">[</span><span class="n">quarter_length</span> <span class="o">*</span> <span class="mi">2</span><span class="p">:]</span>
<span class="n">mystery</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">input_without_first_and_second_quarter</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;\&#39;&lt;3+0-3.24#7=!&amp;60)2/+&quot;;+&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5\&#39;\&#39;&gt;#&#39;, &#39;PASS&#39;)
</pre></div>
</div>
</div>
</div>
<p>This is not too surprising, as we had that one before:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">second_half</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;\&#39;&lt;3+0-3.24#7=!&amp;60)2/+&quot;;+&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5\&#39;\&#39;&gt;#&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">input_without_first_and_second_quarter</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;\&#39;&lt;3+0-3.24#7=!&amp;60)2/+&quot;;+&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5\&#39;\&#39;&gt;#&#39;
</pre></div>
</div>
</div>
</div>
<p>How about removing the third quarter, then?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">input_without_first_and_third_quarter</span> <span class="o">=</span> <span class="n">failing_input</span><span class="p">[</span><span class="n">quarter_length</span><span class="p">:</span>
                                                      <span class="n">quarter_length</span> <span class="o">*</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">failing_input</span><span class="p">[</span><span class="n">quarter_length</span> <span class="o">*</span> <span class="mi">3</span><span class="p">:]</span>
<span class="n">mystery</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">input_without_first_and_third_quarter</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&quot;50#7*8=$&amp;&amp;=$9!%6(4=&amp;69&#39;:&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5&#39;&#39;&gt;#&quot;, &#39;PASS&#39;)
</pre></div>
</div>
</div>
</div>
<p>Ok.  Let us remove the fourth quarter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">input_without_first_and_fourth_quarter</span> <span class="o">=</span> <span class="n">failing_input</span><span class="p">[</span><span class="n">quarter_length</span><span class="p">:</span><span class="n">quarter_length</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">mystery</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">input_without_first_and_fourth_quarter</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;50#7*8=$&amp;&amp;=$9!%6(4=&amp;69\&#39;:\&#39;&lt;3+0-3.24#7=!&amp;60)2/+&quot;;+&#39;, &#39;FAIL&#39;)
</pre></div>
</div>
</div>
</div>
<p>Yes!  This has succeeded.  Our input is now 50% smaller.</p>
<p>We have now tried to remove pieces that make up <span class="math notranslate nohighlight">\(\frac{1}{2}\)</span> and <span class="math notranslate nohighlight">\(\frac{1}{4}\)</span> of the original failing string.  In the next iteration, we would go and remove even smaller pieces – <span class="math notranslate nohighlight">\(\frac{1}{8}\)</span>, <span class="math notranslate nohighlight">\(\frac{1}{16}\)</span> and so on.  We continue until we are down to <span class="math notranslate nohighlight">\(\frac{1}{97}\)</span> – that is, individual characters.</p>
<p>However, this is something we happily let a computer do for us.  We first introduce a <code class="docutils literal notranslate"><span class="pre">Reducer</span></code> class as an abstract superclass for all kinds of reducers.  The <code class="docutils literal notranslate"><span class="pre">test()</span></code> method runs a single test (with logging, if wanted); the <code class="docutils literal notranslate"><span class="pre">reduce()</span></code> method will eventually reduce an input to the minimum.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Reducer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for reducers.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runner</span><span class="p">:</span> <span class="n">Runner</span><span class="p">,</span> <span class="n">log_test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Attach reducer to the given `runner`&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runner</span> <span class="o">=</span> <span class="n">runner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_test</span> <span class="o">=</span> <span class="n">log_test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset the test counter to zero. To be extended in subclasses.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tests</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Outcome</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test with input `inp`. Return outcome.</span>
<span class="sd">        To be extended in subclasses.&quot;&quot;&quot;</span>

        <span class="n">result</span><span class="p">,</span> <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tests</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_test</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test #</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">tests</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">inp</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">)),</span> <span class="n">outcome</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outcome</span>

    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reduce input `inp`. Return reduced input.</span>
<span class="sd">        To be defined in subclasses.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="c1"># Default: Don&#39;t reduce</span>
        <span class="k">return</span> <span class="n">inp</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">CachingReducer</span></code> variant saves test results, such that we don’t have to run the same tests again and again:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CachingReducer</span><span class="p">(</span><span class="n">Reducer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A reducer that also caches test outcomes&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">inp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">inp</span><span class="p">]</span>

        <span class="n">outcome</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">inp</span><span class="p">]</span> <span class="o">=</span> <span class="n">outcome</span>
        <span class="k">return</span> <span class="n">outcome</span>
</pre></div>
</div>
</div>
</div>
<p>Here comes the <em>Delta Debugging</em> reducer.  Delta Debugging implements the strategy sketched above: It first removes larger chunks of size <span class="math notranslate nohighlight">\(\frac{1}{2}\)</span>; if this does not fail, then we proceed to chunks of size <span class="math notranslate nohighlight">\(\frac{1}{4}\)</span>, then <span class="math notranslate nohighlight">\(\frac{1}{8}\)</span> and so on.</p>
<p>Our implementation uses almost the same Python code as Zeller in \cite{Zeller2002}; the only difference is that it has been adapted to work on Python 3 and our <code class="docutils literal notranslate"><span class="pre">Runner</span></code> framework.  The variable <code class="docutils literal notranslate"><span class="pre">n</span></code> (initially 2) indicates the granularity – in each step, chunks of size <span class="math notranslate nohighlight">\(\frac{1}{n}\)</span> are cut away.  If none of the test fails (<code class="docutils literal notranslate"><span class="pre">some_complement_is_failing</span></code> is False), then <code class="docutils literal notranslate"><span class="pre">n</span></code> is doubled – until it reaches the length of the input.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DeltaDebuggingReducer</span><span class="p">(</span><span class="n">CachingReducer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reduce inputs using delta debugging.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reduce input `inp` using delta debugging. Return reduced input.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Runner</span><span class="o">.</span><span class="n">PASS</span>

        <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span>     <span class="c1"># Initial granularity</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">subset_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span>
            <span class="n">some_complement_is_failing</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">while</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">):</span>
                <span class="n">complement</span> <span class="o">=</span> <span class="n">inp</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)]</span> <span class="o">+</span> \
                    <span class="n">inp</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="n">subset_length</span><span class="p">):]</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">complement</span><span class="p">)</span> <span class="o">==</span> <span class="n">Runner</span><span class="o">.</span><span class="n">FAIL</span><span class="p">:</span>
                    <span class="n">inp</span> <span class="o">=</span> <span class="n">complement</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="n">some_complement_is_failing</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>

                <span class="n">start</span> <span class="o">+=</span> <span class="n">subset_length</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">some_complement_is_failing</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">):</span>
                    <span class="k">break</span>
                <span class="n">n</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">inp</span>
</pre></div>
</div>
</div>
</div>
<p>To see how the <code class="docutils literal notranslate"><span class="pre">DeltaDebuggingReducer</span></code> works, let us run it on our failing input.  With each step, we see how the remaining input gets smaller and smaller, until only two characters remain:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd_reducer</span> <span class="o">=</span> <span class="n">DeltaDebuggingReducer</span><span class="p">(</span><span class="n">mystery</span><span class="p">,</span> <span class="n">log_test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dd_reducer</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">failing_input</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test #1 &#39; 7:,&gt;((/$$-/-&gt;.;.=;(.%!:50#7*8=$&amp;&amp;=$9!%6(4=&amp;69\&#39;:\&#39;&lt;3+0-3.24#7=!&amp;60)2/+&quot;;+&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5\&#39;\&#39;&gt;#&#39; 97 FAIL
Test #2 &#39;\&#39;&lt;3+0-3.24#7=!&amp;60)2/+&quot;;+&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5\&#39;\&#39;&gt;#&#39; 49 PASS
Test #3 &quot; 7:,&gt;((/$$-/-&gt;.;.=;(.%!:50#7*8=$&amp;&amp;=$9!%6(4=&amp;69&#39;:&quot; 48 PASS
Test #4 &#39;50#7*8=$&amp;&amp;=$9!%6(4=&amp;69\&#39;:\&#39;&lt;3+0-3.24#7=!&amp;60)2/+&quot;;+&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5\&#39;\&#39;&gt;#&#39; 73 FAIL
Test #5 &quot;50#7*8=$&amp;&amp;=$9!%6(4=&amp;69&#39;:&lt;7+1&lt;2!4$&gt;92+$1&lt;(3%&amp;5&#39;&#39;&gt;#&quot; 49 PASS
Test #6 &#39;50#7*8=$&amp;&amp;=$9!%6(4=&amp;69\&#39;:\&#39;&lt;3+0-3.24#7=!&amp;60)2/+&quot;;+&#39; 48 FAIL
Test #7 &#39;\&#39;&lt;3+0-3.24#7=!&amp;60)2/+&quot;;+&#39; 24 PASS
Test #8 &quot;50#7*8=$&amp;&amp;=$9!%6(4=&amp;69&#39;:&quot; 24 PASS
Test #9 &#39;9!%6(4=&amp;69\&#39;:\&#39;&lt;3+0-3.24#7=!&amp;60)2/+&quot;;+&#39; 36 FAIL
Test #10 &#39;9!%6(4=&amp;69\&#39;:=!&amp;60)2/+&quot;;+&#39; 24 FAIL
Test #11 &#39;=!&amp;60)2/+&quot;;+&#39; 12 PASS
Test #12 &quot;9!%6(4=&amp;69&#39;:&quot; 12 PASS
Test #13 &#39;=&amp;69\&#39;:=!&amp;60)2/+&quot;;+&#39; 18 PASS
Test #14 &#39;9!%6(4=!&amp;60)2/+&quot;;+&#39; 18 FAIL
Test #15 &#39;9!%6(42/+&quot;;+&#39; 12 PASS
Test #16 &#39;9!%6(4=!&amp;60)&#39; 12 FAIL
Test #17 &#39;=!&amp;60)&#39; 6 PASS
Test #18 &#39;9!%6(4&#39; 6 PASS
Test #19 &#39;6(4=!&amp;60)&#39; 9 FAIL
Test #20 &#39;6(460)&#39; 6 FAIL
Test #21 &#39;60)&#39; 3 PASS
Test #22 &#39;6(4&#39; 3 PASS
Test #23 &#39;(460)&#39; 5 FAIL
Test #24 &#39;460)&#39; 4 PASS
Test #25 &#39;(0)&#39; 3 FAIL
Test #26 &#39;0)&#39; 2 PASS
Test #27 &#39;(&#39; 1 PASS
Test #28 &#39;()&#39; 2 FAIL
Test #29 &#39;)&#39; 1 PASS
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;()&#39;
</pre></div>
</div>
</div>
</div>
<p>Now we know why <code class="docutils literal notranslate"><span class="pre">MysteryRunner</span></code> fails – it suffices that the input contains two matching parentheses.  Delta Debugging determines this in 29 steps.  Its result is <em>1-minimal</em>, meaning that every character contained is required to produce the error; removing any (as seen in tests <code class="docutils literal notranslate"><span class="pre">#27</span></code> and <code class="docutils literal notranslate"><span class="pre">#29</span></code>, above) no longer makes the test fail.  This property is guaranteed by the delta debugging algorithm, which in its last stage always tries to delete characters one by one.</p>
<p>A reduced test case such as the one above has many advantages:</p>
<ul class="simple">
<li><p>A reduced test case <strong>reduces the <em>cognitive load</em> of the programmer</strong>.  The test case is shorter and focused, and thus does not burden the programmer with irrelevant details.  A reduced input typically leads to shorter executions and smaller program states, both of which reduce the search space as it comes to understanding the bug.  In our case, we have eliminated lots of irrelevant input – only the two characters the reduced input contains are relevant.</p></li>
<li><p>A reduced test case <strong>is easier to communicate</strong>.  All one needs here is the summary: <code class="docutils literal notranslate"><span class="pre">MysteryRunner</span> <span class="pre">fails</span> <span class="pre">on</span> <span class="pre">&quot;()&quot;</span></code>, which is much better than <code class="docutils literal notranslate"><span class="pre">MysteryRunner</span> <span class="pre">fails</span> <span class="pre">on</span> <span class="pre">a</span> <span class="pre">4100-character</span> <span class="pre">input</span> <span class="pre">(attached)</span></code>.</p></li>
<li><p>A reduced test case helps in <strong>identifying duplicates</strong>.  If similar bugs have been reported already, and all of them have been reduced to the same cause (namely that the input contains matching parentheses), then it becomes obvious that all these bugs are different symptoms of the same underlying cause – and would all be resolved at once with one code fix.</p></li>
</ul>
<p>How effective is delta debugging?  In the best case (when the left half or the right half fails), the number of tests is logarithmic proportional to the length <span class="math notranslate nohighlight">\(n\)</span> of an input (i.e., <span class="math notranslate nohighlight">\(O(\log_2 n)\)</span>); this is the same complexity as binary search.  In the worst case, though, delta debugging can require a number of tests proportional to <span class="math notranslate nohighlight">\(n^2\)</span> (i.e., <span class="math notranslate nohighlight">\(O(n^2)\)</span>) – this happens in the case when we are down to character granularity, and we have to repeatedly tried to delete all characters, only to find that deleting the last character results in a failure \cite{Zeller2002}.  (This is a pretty pathological situation, though.)</p>
<p>In general, delta debugging is a robust algorithm that is easy to implement, easy to deploy, and easy to use – provided that the underlying test case is deterministic and runs quickly enough to warrant a number of experiments.  As these are the same prerequisites that make fuzzing effective, delta debugging makes an excellent companion to fuzzing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quiz</span><span class="p">(</span><span class="s2">&quot;What happens if the function under test does not fail?&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s2">&quot;Delta debugging searches for the minimal input&quot;</span>
        <span class="s2">&quot; that produces the same result&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Delta debugging starts a fuzzer to find a failure&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Delta debugging raises an AssertionError&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Delta debugging runs forever in a loop&quot;</span><span class="p">,</span>
    <span class="p">],</span> <span class="s1">&#39;0 ** 0 + 1 ** 0 + 0 ** 1 + 1 ** 1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
    
    <script>
    var bad_answers = new Map();

    function answer(quiz_id) {
        ans = 0;
        for (i = 1;; i++) {
            checkbox = document.getElementById(quiz_id + "-" + i.toString());
            if (!checkbox)
                break;
            if (checkbox.checked)
                ans |= (1 << i);
        }
        return ans;
    }
    function check_selection(quiz_id, correct_answer, multiple_choice, hint) {
        given_answer = answer(quiz_id);
        if (given_answer == correct_answer)
        {
            document.getElementById(quiz_id + "-submit").value = "Correct!";
            document.getElementById(quiz_id + "-hint").innerHTML = "";

            for (i = 1;; i++) {
                checkbox = document.getElementById(quiz_id + "-" + i.toString());
                label = document.getElementById(quiz_id + "-" + i.toString() + "-label")
                if (!checkbox)
                    break;

                if (checkbox.checked) {
                    label.style.fontWeight = "bold";
                }
                else {
                    label.style.textDecoration = "line-through";
                }
            }
        }
        else 
        {
            document.getElementById(quiz_id + "-submit").value = "Try again";

            if (!bad_answers.has(quiz_id)) {
                bad_answers.set(quiz_id, 1);
            }
            else {
                bad_answers.set(quiz_id, bad_answers.get(quiz_id) + 1);
            }

            if (bad_answers.get(quiz_id) >= 2 && hint.length > 0) {
                document.getElementById(quiz_id + "-hint").innerHTML = 
                    "&nbsp;&nbsp;(Hint: <code>" + hint + "</code>)";
            }

            if (!multiple_choice) {
                for (i = 1;; i++) {
                    checkbox = document.getElementById(quiz_id + "-" + i.toString());
                    label = document.getElementById(quiz_id + "-" + i.toString() + "-label")

                    if (!checkbox)
                        break;
                    if (checkbox.checked) {
                        label.style.textDecoration = "line-through";
                    }
                }
            }
        }
    }
    function clear_selection(quiz_id) {
        document.getElementById(quiz_id + "-submit").value = "Submit";
        document.getElementById(quiz_id + "-hint").innerHTML = "";
    }
    </script>
    
    <div class="quiz">
    <h3 class="quiz_title">Quiz</h3>
    <p>
    <div class="quiz_question">What happens if the function under test does not fail?</div>
    </p>
    <p>
    <div class="quiz_options" title="Pick a choice.">
    
        <input type="radio" name="f10c350e-d3ef-11ef-83cb-6298cf1a5790" id="f10c350e-d3ef-11ef-83cb-6298cf1a5790-1" onclick="clear_selection('f10c350e-d3ef-11ef-83cb-6298cf1a5790')">
        <label id="f10c350e-d3ef-11ef-83cb-6298cf1a5790-1-label" for="f10c350e-d3ef-11ef-83cb-6298cf1a5790-1">Delta debugging searches for the minimal input that produces the same result</label><br>
    
        <input type="radio" name="f10c350e-d3ef-11ef-83cb-6298cf1a5790" id="f10c350e-d3ef-11ef-83cb-6298cf1a5790-2" onclick="clear_selection('f10c350e-d3ef-11ef-83cb-6298cf1a5790')">
        <label id="f10c350e-d3ef-11ef-83cb-6298cf1a5790-2-label" for="f10c350e-d3ef-11ef-83cb-6298cf1a5790-2">Delta debugging starts a fuzzer to find a failure</label><br>
    
        <input type="radio" name="f10c350e-d3ef-11ef-83cb-6298cf1a5790" id="f10c350e-d3ef-11ef-83cb-6298cf1a5790-3" onclick="clear_selection('f10c350e-d3ef-11ef-83cb-6298cf1a5790')">
        <label id="f10c350e-d3ef-11ef-83cb-6298cf1a5790-3-label" for="f10c350e-d3ef-11ef-83cb-6298cf1a5790-3">Delta debugging raises an AssertionError</label><br>
    
        <input type="radio" name="f10c350e-d3ef-11ef-83cb-6298cf1a5790" id="f10c350e-d3ef-11ef-83cb-6298cf1a5790-4" onclick="clear_selection('f10c350e-d3ef-11ef-83cb-6298cf1a5790')">
        <label id="f10c350e-d3ef-11ef-83cb-6298cf1a5790-4-label" for="f10c350e-d3ef-11ef-83cb-6298cf1a5790-4">Delta debugging runs forever in a loop</label><br>
    
    </div>
    </p>
    <input id="f10c350e-d3ef-11ef-83cb-6298cf1a5790-submit" type="submit" value="Submit" onclick="check_selection('f10c350e-d3ef-11ef-83cb-6298cf1a5790', 8, 0, '0 ** 0 + 1 ** 0 + 0 ** 1 + 1 ** 1')">
    <span class="quiz_hint" id="f10c350e-d3ef-11ef-83cb-6298cf1a5790-hint"></span>
    </div>
    </div></div>
</div>
<p>Indeed, <code class="docutils literal notranslate"><span class="pre">DeltaDebugger</span></code> checks if its assumptions hold. If not, an assertion fails.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="n">dd_reducer</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="s2">&quot;I am a passing input&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test #1 &#39;I am a passing input&#39; 20 PASS
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_29923/3080932113.py&quot;, line 2, in &lt;module&gt;
    dd_reducer.reduce(&quot;I am a passing input&quot;)
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_29923/2870451724.py&quot;, line 8, in reduce
    assert self.test(inp) != Runner.PASS
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError (expected)
</pre></div>
</div>
</div>
</div>
</section>
<section id="grammar-based-input-reduction">
<h2>Grammar-Based Input Reduction<a class="headerlink" href="#grammar-based-input-reduction" title="Link to this heading">#</a></h2>
<p>If the input language is syntactically complex, delta debugging may take several attempts at reduction, and may not be able to reduce inputs at all.  In the second half of this chapter, we thus introduce an algorithm named <em>Grammar-Based Reduction</em> (or GRABR for short) that makes use of <em>grammars</em> to reduce syntactically complex inputs.</p>
<section id="lexical-reduction-vs-syntactic-rules">
<h3>Lexical Reduction vs. Syntactic Rules<a class="headerlink" href="#lexical-reduction-vs-syntactic-rules" title="Link to this heading">#</a></h3>
<p>Despite its general robustness, there are situations in which delta debugging might be inefficient or outright fail.  As an example, consider some <em>expression input</em> such as <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">+</span> <span class="pre">(2</span> <span class="pre">*</span> <span class="pre">3)</span></code>.  Delta debugging requires a number of tests to simplify the failure-inducing input, but it eventually returns a minimal input</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">expr_input</span> <span class="o">=</span> <span class="s2">&quot;1 + (2 * 3)&quot;</span>
<span class="n">dd_reducer</span> <span class="o">=</span> <span class="n">DeltaDebuggingReducer</span><span class="p">(</span><span class="n">mystery</span><span class="p">,</span> <span class="n">log_test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dd_reducer</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">expr_input</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test #1 &#39;1 + (2 * 3)&#39; 11 FAIL
Test #2 &#39;2 * 3)&#39; 6 PASS
Test #3 &#39;1 + (&#39; 5 PASS
Test #4 &#39;+ (2 * 3)&#39; 9 FAIL
Test #5 &#39;+ ( 3)&#39; 6 FAIL
Test #6 &#39; 3)&#39; 3 PASS
Test #7 &#39;+ (&#39; 3 PASS
Test #8 &#39; ( 3)&#39; 5 FAIL
Test #9 &#39;( 3)&#39; 4 FAIL
Test #10 &#39;3)&#39; 2 PASS
Test #11 &#39;( &#39; 2 PASS
Test #12 &#39;(3)&#39; 3 FAIL
Test #13 &#39;()&#39; 2 FAIL
Test #14 &#39;)&#39; 1 PASS
Test #15 &#39;(&#39; 1 PASS
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;()&#39;
</pre></div>
</div>
</div>
</div>
<p>Looking at the tests, above, though, only few of them actually represent syntactically valid arithmetic expressions.  In a practical setting, we may want to test a program which actually <em>parses</em> such expressions, and which would <em>reject</em> all invalid inputs.  We define a class <code class="docutils literal notranslate"><span class="pre">EvalMysteryRunner</span></code> which first <em>parses</em> the given input (according to the rules of our expression grammar), and <em>only</em> if it fits would it be passed to our original <code class="docutils literal notranslate"><span class="pre">MysteryRunner</span></code>.  This simulates a setting in which we test an expression interpreter, and in which only valid inputs can trigger the bug.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Grammars</span> <span class="kn">import</span> <span class="n">EXPR_GRAMMAR</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Parser</span> <span class="kn">import</span> <span class="n">EarleyParser</span><span class="p">,</span> <span class="n">Parser</span>  <span class="c1"># minor dependency</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">EvalMysteryRunner</span><span class="p">(</span><span class="n">MysteryRunner</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="n">EarleyParser</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Outcome</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tree</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">Runner</span><span class="o">.</span><span class="n">UNRESOLVED</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eval_mystery</span> <span class="o">=</span> <span class="n">EvalMysteryRunner</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Under these circumstances, it turns out that delta debugging utterly fails.  None of the reductions it applies yield a syntactically valid input, so the input as a whole remains as complex as it was before.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd_reducer</span> <span class="o">=</span> <span class="n">DeltaDebuggingReducer</span><span class="p">(</span><span class="n">eval_mystery</span><span class="p">,</span> <span class="n">log_test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dd_reducer</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">expr_input</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test #1 &#39;1 + (2 * 3)&#39; 11 FAIL
Test #2 &#39;2 * 3)&#39; 6 UNRESOLVED
Test #3 &#39;1 + (&#39; 5 UNRESOLVED
Test #4 &#39;+ (2 * 3)&#39; 9 UNRESOLVED
Test #5 &#39;1 2 * 3)&#39; 8 UNRESOLVED
Test #6 &#39;1 + ( 3)&#39; 8 UNRESOLVED
Test #7 &#39;1 + (2 *&#39; 8 UNRESOLVED
Test #8 &#39; + (2 * 3)&#39; 10 UNRESOLVED
Test #9 &#39;1+ (2 * 3)&#39; 10 UNRESOLVED
Test #10 &#39;1 (2 * 3)&#39; 9 UNRESOLVED
Test #11 &#39;1 + 2 * 3)&#39; 10 UNRESOLVED
Test #12 &#39;1 + ( * 3)&#39; 10 UNRESOLVED
Test #13 &#39;1 + (2 3)&#39; 9 UNRESOLVED
Test #14 &#39;1 + (2 *3)&#39; 10 UNRESOLVED
Test #15 &#39;1 + (2 * &#39; 9 UNRESOLVED
Test #16 &#39;1  (2 * 3)&#39; 10 UNRESOLVED
Test #17 &#39;1 +(2 * 3)&#39; 10 UNRESOLVED
Test #18 &#39;1 + (2* 3)&#39; 10 UNRESOLVED
Test #19 &#39;1 + (2  3)&#39; 10 UNRESOLVED
Test #20 &#39;1 + (2 * )&#39; 10 UNRESOLVED
Test #21 &#39;1 + (2 * 3&#39; 10 UNRESOLVED
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;1 + (2 * 3)&#39;
</pre></div>
</div>
</div>
</div>
<p>This behavior is possible if the program under test has several constraints regarding input validity.  Delta debugging is not aware of these constraints (nor of the input structure in general), so it might violate these constraints again and again.</p>
</section>
<section id="a-grammar-based-reduction-approach">
<h3>A Grammar-Based Reduction Approach<a class="headerlink" href="#a-grammar-based-reduction-approach" title="Link to this heading">#</a></h3>
<p>To reduce inputs with high syntactical complexity, we use another approach: Rather than reducing the input string, we reduce the <em>tree</em> representing its structure.  The general idea is to start with a <em>derivation tree</em> coming from parsing the input, and then <em>substitute subtrees by smaller subtrees of the same type</em>.  These alternate subtrees can either come</p>
<ol class="arabic simple">
<li><p>From the tree itself, or</p></li>
<li><p>By applying an alternate grammar expansion using elements from the tree.</p></li>
</ol>
<p>Let us show these two strategies using an example.  We start with a derivation tree from an arithmetic expression:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Grammars</span> <span class="kn">import</span> <span class="n">Grammar</span>
<span class="kn">from</span> <span class="nn">GrammarFuzzer</span> <span class="kn">import</span> <span class="n">all_terminals</span><span class="p">,</span> <span class="n">expansion_to_children</span><span class="p">,</span> <span class="n">display_tree</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">derivation_tree</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">EarleyParser</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">)</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">expr_input</span><span class="p">)</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/41a8b9cbd9065249a2fdd9beedcb7feaee897ae1750dbeb3c0fc16160134284c.svg" src="_images/41a8b9cbd9065249a2fdd9beedcb7feaee897ae1750dbeb3c0fc16160134284c.svg" />
</div>
</div>
</section>
<section id="simplifying-by-replacing-subtrees">
<h3>Simplifying by Replacing Subtrees<a class="headerlink" href="#simplifying-by-replacing-subtrees" title="Link to this heading">#</a></h3>
<p>To simplify this tree, we could replace any <code class="docutils literal notranslate"><span class="pre">&lt;expr&gt;</span></code> symbol up in the tree with some <code class="docutils literal notranslate"><span class="pre">&lt;expr&gt;</span></code> subtree down in the tree.  For instance, we could replace the uppermost <code class="docutils literal notranslate"><span class="pre">&lt;expr&gt;</span></code> with its right <code class="docutils literal notranslate"><span class="pre">&lt;expr&gt;</span></code> subtree, yielding the string <code class="docutils literal notranslate"><span class="pre">(2</span> <span class="pre">+</span> <span class="pre">3)</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">copy</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">new_derivation_tree</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
<span class="c1"># We really should have some query language</span>
<span class="n">sub_expr_tree</span> <span class="o">=</span> <span class="n">new_derivation_tree</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">sub_expr_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/acfa81d8d70f82ea5b2bcfa0cd5227d8679593481c1c3e574e4fd181b53027aa.svg" src="_images/acfa81d8d70f82ea5b2bcfa0cd5227d8679593481c1c3e574e4fd181b53027aa.svg" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">new_derivation_tree</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sub_expr_tree</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">new_derivation_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/51abe9b65d8aa09f3c996bcc66f6679ac8ad847d2cb1d7605bd2e56f3b1398e9.svg" src="_images/51abe9b65d8aa09f3c996bcc66f6679ac8ad847d2cb1d7605bd2e56f3b1398e9.svg" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_terminals</span><span class="p">(</span><span class="n">new_derivation_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;(2 * 3)&#39;
</pre></div>
</div>
</div>
</div>
<p>Replacing one subtree by another only works as long as individual elements such as <code class="docutils literal notranslate"><span class="pre">&lt;expr&gt;</span></code> occur multiple times in our tree.  In the reduced <code class="docutils literal notranslate"><span class="pre">new_derivation_tree</span></code>, above, we could replace further <code class="docutils literal notranslate"><span class="pre">&lt;expr&gt;</span></code> trees only once more.</p>
</section>
<section id="simplifying-by-alternative-expansions">
<h3>Simplifying by Alternative Expansions<a class="headerlink" href="#simplifying-by-alternative-expansions" title="Link to this heading">#</a></h3>
<p>A second means to simplify this tree is to apply <em>alternative expansions</em>.  That is, for a symbol, we check whether there is an alternative expansion with a smaller number of children.  Then, we replace the symbol with the alternative expansion, filling in needed symbols from the tree.</p>
<p>As an example, consider the <code class="docutils literal notranslate"><span class="pre">new_derivation_tree</span></code> above.  The applied expansion for <code class="docutils literal notranslate"><span class="pre">&lt;term&gt;</span></code> has been</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;term&gt; ::= &lt;term&gt; * &lt;factor&gt;
</pre></div>
</div>
<p>Let us replace this with the alternative expansion:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;term&gt; ::= &lt;factor&gt;
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">term_tree</span> <span class="o">=</span> <span class="n">new_derivation_tree</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">term_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9b3aced4f708317573d9bad3aa3b5a221084a6061ea087bb7f4e11cf3a1147f9.svg" src="_images/9b3aced4f708317573d9bad3aa3b5a221084a6061ea087bb7f4e11cf3a1147f9.svg" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shorter_term_tree</span> <span class="o">=</span> <span class="n">term_tree</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">shorter_term_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/29339db6d21f3594f560a71d648b6f48574c8a8e4d4cc96fa949068ffa41ba3b.svg" src="_images/29339db6d21f3594f560a71d648b6f48574c8a8e4d4cc96fa949068ffa41ba3b.svg" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">new_derivation_tree</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">shorter_term_tree</span>
<span class="n">display_tree</span><span class="p">(</span><span class="n">new_derivation_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c2b2c3ba9aca6b867d16f3ef1b41704a19cb3a8c558aba93bd057133f9ff29f1.svg" src="_images/c2b2c3ba9aca6b867d16f3ef1b41704a19cb3a8c558aba93bd057133f9ff29f1.svg" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_terminals</span><span class="p">(</span><span class="n">new_derivation_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;(3)&#39;
</pre></div>
</div>
</div>
</div>
<p>If we replace derivation subtrees by (smaller) subtrees, and if we search for alternate expansions that again yield smaller subtrees, we can systematically simplify the input.  This could be much faster than delta debugging, as our inputs would always be syntactically valid.  However, we need a strategy for when to apply which simplification rule. This is what we develop in the remainder of this section.</p>
</section>
<section id="excursion-a-class-for-reducing-with-grammars">
<h3>Excursion: A Class for Reducing with Grammars<a class="headerlink" href="#excursion-a-class-for-reducing-with-grammars" title="Link to this heading">#</a></h3>
<p>We introduce the <code class="docutils literal notranslate"><span class="pre">GrammarReducer</span></code> class, which is again a <code class="docutils literal notranslate"><span class="pre">Reducer</span></code>. Note that we derive from <code class="docutils literal notranslate"><span class="pre">CachingReducer</span></code>, as the strategy will produce several duplicates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GrammarReducer</span><span class="p">(</span><span class="n">CachingReducer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reduce inputs using grammars&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runner</span><span class="p">:</span> <span class="n">Runner</span><span class="p">,</span> <span class="n">parser</span><span class="p">:</span> <span class="n">Parser</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                 <span class="n">log_test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">log_reduce</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor.</span>
<span class="sd">        `runner` is the runner to be used.</span>
<span class="sd">        `parser` is the parser to be used.</span>
<span class="sd">        `log_test` - if set, show tests and results.</span>
<span class="sd">        `log_reduce` - if set, show reduction steps.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">runner</span><span class="p">,</span> <span class="n">log_test</span><span class="o">=</span><span class="n">log_test</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="n">parser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">grammar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_symbol</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">start_symbol</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_reduce</span> <span class="o">=</span> <span class="n">log_reduce</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">try_all_combinations</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</div>
<section id="a-few-helpers">
<h4>A Few Helpers<a class="headerlink" href="#a-few-helpers" title="Link to this heading">#</a></h4>
<p>We define a number of helper functions, which we will need for our strategy.  <code class="docutils literal notranslate"><span class="pre">tree_list_to_string()</span></code> does what the name suggest, creating a string from a list of derivation trees:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">GrammarFuzzer</span> <span class="kn">import</span> <span class="n">DerivationTree</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">tree_list_to_string</span><span class="p">(</span><span class="n">q</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DerivationTree</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="s2">&quot;[&quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span> <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">q</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tree_list_to_string</span><span class="p">([</span><span class="n">derivation_tree</span><span class="p">,</span> <span class="n">derivation_tree</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;[1 + (2 * 3), 1 + (2 * 3)]&#39;
</pre></div>
</div>
</div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">possible_combinations()</span></code> takes a list of lists <span class="math notranslate nohighlight">\([[x_1, x_2], [y_1, y_2], \dots]\)</span> and creates a list of combinations <span class="math notranslate nohighlight">\([[x_1, y_1], [x_1, y_2], [x_2, y_1], [x_2, y_2], \dots]\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">possible_combinations</span><span class="p">(</span><span class="n">list_of_lists</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_lists</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">list_of_lists</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_lists</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">e</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">possible_combinations</span><span class="p">(</span><span class="n">list_of_lists</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
                <span class="n">new_combo</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_combo</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ret</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">possible_combinations</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[1, &#39;a&#39;], [1, &#39;b&#39;], [2, &#39;a&#39;], [2, &#39;b&#39;]]
</pre></div>
</div>
</div>
</div>
<p>The functions <code class="docutils literal notranslate"><span class="pre">number_of_nodes()</span></code> and <code class="docutils literal notranslate"><span class="pre">max_height()</span></code> return the number of nodes and the maximum height of the given tree, respectively.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">number_of_nodes</span><span class="p">(</span><span class="n">tree</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span> <span class="o">=</span> <span class="n">tree</span>
    <span class="k">if</span> <span class="n">children</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">([</span><span class="n">number_of_nodes</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">children</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">number_of_nodes</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>25
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">max_height</span><span class="p">(</span><span class="n">tree</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span> <span class="o">=</span> <span class="n">tree</span>
    <span class="k">if</span> <span class="n">children</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">max</span><span class="p">([</span><span class="n">max_height</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">children</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">max_height</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>12
</pre></div>
</div>
</div>
</div>
</section>
<section id="simplification-strategies">
<h4>Simplification Strategies<a class="headerlink" href="#simplification-strategies" title="Link to this heading">#</a></h4>
<p>Let us now implement our two simplification strategies – replacing subtrees and alternate expansions.</p>
<section id="finding-subtrees">
<h5>Finding Subtrees<a class="headerlink" href="#finding-subtrees" title="Link to this heading">#</a></h5>
<p>The method <code class="docutils literal notranslate"><span class="pre">subtrees_with_symbol()</span></code> returns all subtrees in the given tree which’s root is equal to the given symbol.  If <code class="docutils literal notranslate"><span class="pre">ignore_root</span></code> is set (default), then the root node of <code class="docutils literal notranslate"><span class="pre">tree</span></code> is not compared against.  (The <code class="docutils literal notranslate"><span class="pre">depth</span></code> parameter will be discussed below.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GrammarReducer</span><span class="p">(</span><span class="n">GrammarReducer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">subtrees_with_symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">,</span>
                             <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                             <span class="n">ignore_root</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DerivationTree</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find all subtrees in `tree` whose root is `symbol`.</span>
<span class="sd">        If `ignore_root` is true, ignore the root note of `tree`.&quot;&quot;&quot;</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="p">(</span><span class="n">child_symbol</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span> <span class="o">=</span> <span class="n">tree</span>
        <span class="k">if</span> <span class="n">depth</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ignore_root</span> <span class="ow">and</span> <span class="n">child_symbol</span> <span class="o">==</span> <span class="n">symbol</span><span class="p">:</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>

        <span class="c1"># Search across all children</span>
        <span class="k">if</span> <span class="n">depth</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">children</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtrees_with_symbol</span><span class="p">(</span><span class="n">c</span><span class="p">,</span>
                                                 <span class="n">symbol</span><span class="p">,</span>
                                                 <span class="n">depth</span><span class="o">=</span><span class="n">depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                                 <span class="n">ignore_root</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ret</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s an example: These are all subtrees with <code class="docutils literal notranslate"><span class="pre">&lt;term&gt;</span></code> in our derivation tree <code class="docutils literal notranslate"><span class="pre">derivation_tree</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grammar_reducer</span> <span class="o">=</span> <span class="n">GrammarReducer</span><span class="p">(</span>
    <span class="n">mystery</span><span class="p">,</span>
    <span class="n">EarleyParser</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">),</span>
    <span class="n">log_reduce</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_terminals</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;1 + (2 * 3)&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">all_terminals</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">grammar_reducer</span><span class="o">.</span><span class="n">subtrees_with_symbol</span><span class="p">(</span>
    <span class="n">derivation_tree</span><span class="p">,</span> <span class="s2">&quot;&lt;term&gt;&quot;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;1&#39;, &#39;(2 * 3)&#39;, &#39;2 * 3&#39;, &#39;3&#39;]
</pre></div>
</div>
</div>
</div>
<p>If we want to replace <code class="docutils literal notranslate"><span class="pre">&lt;term&gt;</span></code> subtrees to simplify the tree, these are the subtrees we could replace them with.</p>
</section>
<section id="alternate-expansions">
<h5>Alternate Expansions<a class="headerlink" href="#alternate-expansions" title="Link to this heading">#</a></h5>
<p>Our second strategy, simplifying by alternate expansions, is a bit more complex.  We first fetch the possible expansions for the given symbol (starting with the ones with the fewest children).  For each expansion, we fill in values for the symbols from the subtree (using <code class="docutils literal notranslate"><span class="pre">subtrees_with_symbols()</span></code>, above).  We then pick the first possible combination (or <em>all</em> combinations, if the attribute <code class="docutils literal notranslate"><span class="pre">try_all_combinations</span></code> is set).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GrammarReducer</span><span class="p">(</span><span class="n">GrammarReducer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">alternate_reductions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">,</span> <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
                             <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">reductions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">expansions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grammar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">expansions</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">expansion</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">expansion_to_children</span><span class="p">(</span><span class="n">expansion</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">expansion</span> <span class="ow">in</span> <span class="n">expansions</span><span class="p">:</span>
            <span class="n">expansion_children</span> <span class="o">=</span> <span class="n">expansion_to_children</span><span class="p">(</span><span class="n">expansion</span><span class="p">)</span>

            <span class="n">match</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">new_children_reductions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">alt_symbol</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="n">expansion_children</span><span class="p">:</span>
                <span class="n">child_reductions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtrees_with_symbol</span><span class="p">(</span>
                    <span class="n">tree</span><span class="p">,</span> <span class="n">alt_symbol</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child_reductions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">match</span> <span class="o">=</span> <span class="kc">False</span>   <span class="c1"># Child not found; cannot apply rule</span>
                    <span class="k">break</span>

                <span class="n">new_children_reductions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child_reductions</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># Try next alternative</span>

            <span class="c1"># Use the first suitable combination</span>
            <span class="k">for</span> <span class="n">new_children</span> <span class="ow">in</span> <span class="n">possible_combinations</span><span class="p">(</span><span class="n">new_children_reductions</span><span class="p">):</span>
                <span class="n">new_tree</span> <span class="o">=</span> <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">new_children</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">number_of_nodes</span><span class="p">(</span><span class="n">new_tree</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">number_of_nodes</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
                    <span class="n">reductions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_tree</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">try_all_combinations</span><span class="p">:</span>
                        <span class="k">break</span>

        <span class="c1"># Sort by number of nodes</span>
        <span class="n">reductions</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">number_of_nodes</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">reductions</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grammar_reducer</span> <span class="o">=</span> <span class="n">GrammarReducer</span><span class="p">(</span>
    <span class="n">mystery</span><span class="p">,</span>
    <span class="n">EarleyParser</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">),</span>
    <span class="n">log_reduce</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_terminals</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;1 + (2 * 3)&#39;
</pre></div>
</div>
</div>
</div>
<p>Here are <em>all</em> combinations for <code class="docutils literal notranslate"><span class="pre">&lt;term&gt;</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grammar_reducer</span><span class="o">.</span><span class="n">try_all_combinations</span> <span class="o">=</span> <span class="kc">True</span>
<span class="nb">print</span><span class="p">([</span><span class="n">all_terminals</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
       <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">grammar_reducer</span><span class="o">.</span><span class="n">alternate_reductions</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">,</span> <span class="s2">&quot;&lt;term&gt;&quot;</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;1 * 1&#39;, &#39;1 * 3&#39;, &#39;2 * 1&#39;, &#39;2 * 3&#39;, &#39;3 * 1&#39;, &#39;3 * 3&#39;, &#39;(2 * 3)&#39;, &#39;1 * 2 * 3&#39;, &#39;2 * 2 * 3&#39;, &#39;3 * 2 * 3&#39;, &#39;1 * (2 * 3)&#39;, &#39;(2 * 3) * 1&#39;, &#39;(2 * 3) * 3&#39;, &#39;2 * (2 * 3)&#39;, &#39;3 * (2 * 3)&#39;]
</pre></div>
</div>
</div>
</div>
<p>The default, though, is simply to return the first of these:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grammar_reducer</span><span class="o">.</span><span class="n">try_all_combinations</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">[</span><span class="n">all_terminals</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">grammar_reducer</span><span class="o">.</span><span class="n">alternate_reductions</span><span class="p">(</span>
    <span class="n">derivation_tree</span><span class="p">,</span> <span class="s2">&quot;&lt;term&gt;&quot;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;1&#39;, &#39;1 * 1&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="both-strategies-together">
<h5>Both Strategies Together<a class="headerlink" href="#both-strategies-together" title="Link to this heading">#</a></h5>
<p>Let us now merge both strategies.  To replace a subtree with a given symbol, we first search for already existing subtrees (using <code class="docutils literal notranslate"><span class="pre">subtrees_with_symbol()</span></code>); then we go for alternate expansions (using <code class="docutils literal notranslate"><span class="pre">alternate_expansions()</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GrammarReducer</span><span class="p">(</span><span class="n">GrammarReducer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">symbol_reductions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">,</span> <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
                          <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find all expansion alternatives for the given symbol&quot;&quot;&quot;</span>
        <span class="n">reductions</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subtrees_with_symbol</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">)</span>
                      <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">alternate_reductions</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">))</span>

        <span class="c1"># Filter duplicates</span>
        <span class="n">unique_reductions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reductions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">r</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unique_reductions</span><span class="p">:</span>
                <span class="n">unique_reductions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">unique_reductions</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grammar_reducer</span> <span class="o">=</span> <span class="n">GrammarReducer</span><span class="p">(</span>
    <span class="n">mystery</span><span class="p">,</span>
    <span class="n">EarleyParser</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">),</span>
    <span class="n">log_reduce</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_terminals</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;1 + (2 * 3)&#39;
</pre></div>
</div>
</div>
</div>
<p>These are the possible reductions for <code class="docutils literal notranslate"><span class="pre">&lt;expr&gt;</span></code> nodes.  Note how we first return subtrees (<code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">+</span> <span class="pre">(2</span> <span class="pre">*</span> <span class="pre">3)</span></code>, <code class="docutils literal notranslate"><span class="pre">(2</span> <span class="pre">*</span> <span class="pre">3)</span></code>, <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">*</span> <span class="pre">3</span></code>) before going for alternate expansions of <code class="docutils literal notranslate"><span class="pre">&lt;expr&gt;</span></code> (<code class="docutils literal notranslate"><span class="pre">1</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reductions</span> <span class="o">=</span> <span class="n">grammar_reducer</span><span class="o">.</span><span class="n">symbol_reductions</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">,</span> <span class="s2">&quot;&lt;expr&gt;&quot;</span><span class="p">)</span>
<span class="n">tree_list_to_string</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reductions</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;[1 + (2 * 3), (2 * 3), 2 * 3, 1]&#39;
</pre></div>
</div>
</div>
</div>
<p>These are the possible reductions for <code class="docutils literal notranslate"><span class="pre">&lt;term&gt;</span></code> nodes.  Again, we first have subtrees of the derivation tree, followed by the alternate expansion <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">*</span> <span class="pre">1</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reductions</span> <span class="o">=</span> <span class="n">grammar_reducer</span><span class="o">.</span><span class="n">symbol_reductions</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">,</span> <span class="s2">&quot;&lt;term&gt;&quot;</span><span class="p">)</span>
<span class="n">tree_list_to_string</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reductions</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;[1, (2 * 3), 2 * 3, 3, 1 * 1]&#39;
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="the-reduction-strategy">
<h4>The Reduction Strategy<a class="headerlink" href="#the-reduction-strategy" title="Link to this heading">#</a></h4>
<p>We are now able to return a number of alternatives for each symbol in the tree.  This is what we apply in the core function of our reduction strategy, <code class="docutils literal notranslate"><span class="pre">reduce_subtree()</span></code>.  Starting with <code class="docutils literal notranslate"><span class="pre">subtree</span></code>, for every child, we find possible reductions.  For every reduction, we replace the child with the reduction and test the resulting (full) tree.  If it fails, our reduction was successful; otherwise, we put the child back into place and try out the next reduction.  Eventually, we apply <code class="docutils literal notranslate"><span class="pre">reduce_subtree()</span></code> on all children, reducing these as well.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GrammarReducer</span><span class="p">(</span><span class="n">GrammarReducer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">reduce_subtree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">,</span>
                       <span class="n">subtree</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">,</span> <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">symbol</span><span class="p">,</span> <span class="n">children</span> <span class="o">=</span> <span class="n">subtree</span>
        <span class="k">if</span> <span class="n">children</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_reduce</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reducing&quot;</span><span class="p">,</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">subtree</span><span class="p">),</span> <span class="s2">&quot;with depth&quot;</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span>

        <span class="n">reduced</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">reduced_child</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">child</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">children</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">child</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="p">(</span><span class="n">child_symbol</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">child</span>
                <span class="k">for</span> <span class="n">reduction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol_reductions</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">child_symbol</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">number_of_nodes</span><span class="p">(</span><span class="n">reduction</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">number_of_nodes</span><span class="p">(</span><span class="n">child</span><span class="p">):</span>
                        <span class="k">continue</span>

                    <span class="c1"># Try this reduction</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_reduce</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span>
                            <span class="s2">&quot;Replacing&quot;</span><span class="p">,</span>
                            <span class="n">all_terminals</span><span class="p">(</span>
                                <span class="n">children</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                            <span class="s2">&quot;by&quot;</span><span class="p">,</span>
                            <span class="n">all_terminals</span><span class="p">(</span><span class="n">reduction</span><span class="p">))</span>
                    <span class="n">children</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">reduction</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">))</span> <span class="o">==</span> <span class="n">Runner</span><span class="o">.</span><span class="n">FAIL</span><span class="p">:</span>
                        <span class="c1"># Success</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_reduce</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;New tree:&quot;</span><span class="p">,</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">))</span>
                        <span class="n">reduced</span> <span class="o">=</span> <span class="n">reduced_child</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Didn&#39;t work out - restore</span>
                        <span class="n">children</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">child</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">reduced_child</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_reduce</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tried all alternatives for&quot;</span><span class="p">,</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">subtree</span><span class="p">))</span>
                <span class="k">break</span>

        <span class="c1"># Run recursively</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduce_subtree</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
                <span class="n">reduced</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">reduced</span>
</pre></div>
</div>
</div>
</div>
<p>All we now need is a few drivers.  The method <code class="docutils literal notranslate"><span class="pre">reduce_tree()</span></code> is the main entry point into <code class="docutils literal notranslate"><span class="pre">reduce_subtree()</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GrammarReducer</span><span class="p">(</span><span class="n">GrammarReducer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">reduce_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduce_subtree</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The custom method <code class="docutils literal notranslate"><span class="pre">parse()</span></code> turns a given input into a derivation tree:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GrammarReducer</span><span class="p">(</span><span class="n">GrammarReducer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">):</span>
        <span class="n">tree</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_reduce</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">tree</span>
</pre></div>
</div>
</div>
</div>
<p>The method <code class="docutils literal notranslate"><span class="pre">reduce()</span></code> is the one single entry point, parsing the input and then reducing it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GrammarReducer</span><span class="p">(</span><span class="n">GrammarReducer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">):</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reduce_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_terminals</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="end-of-excursion">
<h3>End of Excursion<a class="headerlink" href="#end-of-excursion" title="Link to this heading">#</a></h3>
<p>Let us try out our <code class="docutils literal notranslate"><span class="pre">GrammarReducer</span></code> class in practice on our input <code class="docutils literal notranslate"><span class="pre">expr_input</span></code> and the <code class="docutils literal notranslate"><span class="pre">mystery()</span></code> function.  How quickly can we reduce it?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">expr_input</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;1 + (2 * 3)&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grammar_reducer</span> <span class="o">=</span> <span class="n">GrammarReducer</span><span class="p">(</span>
    <span class="n">eval_mystery</span><span class="p">,</span>
    <span class="n">EarleyParser</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">),</span>
    <span class="n">log_test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">grammar_reducer</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">expr_input</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test #1 &#39;(2 * 3)&#39; 7 FAIL
Test #2 &#39;2 * 3&#39; 5 PASS
Test #3 &#39;3&#39; 1 PASS
Test #4 &#39;2&#39; 1 PASS
Test #5 &#39;(3)&#39; 3 FAIL
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;(3)&#39;
</pre></div>
</div>
</div>
</div>
<p>Success!  In only five steps, our <code class="docutils literal notranslate"><span class="pre">GrammarReducer</span></code> reduces the input to the minimum that causes the failure.  Note how all tests are syntactically valid by construction, avoiding the <code class="docutils literal notranslate"><span class="pre">UNRESOLVED</span></code> outcomes that cause delta debugging to stall.</p>
</section>
<section id="a-depth-oriented-strategy">
<h3>A Depth-Oriented Strategy<a class="headerlink" href="#a-depth-oriented-strategy" title="Link to this heading">#</a></h3>
<p>Even if five steps are already good, we can still do better.  If we look at the log above, we see that after test <code class="docutils literal notranslate"><span class="pre">#2</span></code>, where the input (tree) is reduced to <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">*</span> <span class="pre">3</span></code>, our <code class="docutils literal notranslate"><span class="pre">GrammarReducer</span></code> first tries to replace the tree with <code class="docutils literal notranslate"><span class="pre">2</span></code> and <code class="docutils literal notranslate"><span class="pre">3</span></code>, which are the alternate <code class="docutils literal notranslate"><span class="pre">&lt;term&gt;</span></code> subtrees.  This may work, of course; but if there are many possible subtrees, our strategy will spend quite some time trying one after the other.</p>
<p>Delta debugging, as introduced above, follows the idea of trying to cut inputs approximately in half, and thus quickly proceeds towards a minimal input.  By replacing a tree with much smaller subtrees, we <em>could</em> possibly reduce a tree significantly, but may need several attempts to do so.  A better strategy is to only consider <em>large</em> subtrees first – both for the subtree replacement and for alternate expansions.  To find such <em>large</em> subtrees, we limit the <em>depth</em> by which we search for possible replacements in the subtree – first, by looking at the direct descendants, later at lower descendants.</p>
<p>This is the role of the <code class="docutils literal notranslate"><span class="pre">depth</span></code> parameter used in <code class="docutils literal notranslate"><span class="pre">subtrees_with_symbol()</span></code> and passed through the invoking functions.  If set, <em>only</em> symbols at the given depth are returned.  Here’s an example, starting again with our derivation tree <code class="docutils literal notranslate"><span class="pre">derivation_tree</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grammar_reducer</span> <span class="o">=</span> <span class="n">GrammarReducer</span><span class="p">(</span>
    <span class="n">mystery</span><span class="p">,</span>
    <span class="n">EarleyParser</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">),</span>
    <span class="n">log_reduce</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_terminals</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;1 + (2 * 3)&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display_tree</span><span class="p">(</span><span class="n">derivation_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/41a8b9cbd9065249a2fdd9beedcb7feaee897ae1750dbeb3c0fc16160134284c.svg" src="_images/41a8b9cbd9065249a2fdd9beedcb7feaee897ae1750dbeb3c0fc16160134284c.svg" />
</div>
</div>
<p>At a depth of 1, there is no <code class="docutils literal notranslate"><span class="pre">&lt;term&gt;</span></code> symbol:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">all_terminals</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">grammar_reducer</span><span class="o">.</span><span class="n">subtrees_with_symbol</span><span class="p">(</span>
    <span class="n">derivation_tree</span><span class="p">,</span> <span class="s2">&quot;&lt;term&gt;&quot;</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<p>At a depth of 2, we have the <code class="docutils literal notranslate"><span class="pre">&lt;term&gt;</span></code> subtree on the left-hand side:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">all_terminals</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">grammar_reducer</span><span class="o">.</span><span class="n">subtrees_with_symbol</span><span class="p">(</span>
    <span class="n">derivation_tree</span><span class="p">,</span> <span class="s2">&quot;&lt;term&gt;&quot;</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">2</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;1&#39;]
</pre></div>
</div>
</div>
</div>
<p>At a depth of 3, we have the <code class="docutils literal notranslate"><span class="pre">&lt;term&gt;</span></code> subtree on the right-hand side:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">all_terminals</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">grammar_reducer</span><span class="o">.</span><span class="n">subtrees_with_symbol</span><span class="p">(</span>
    <span class="n">derivation_tree</span><span class="p">,</span> <span class="s2">&quot;&lt;term&gt;&quot;</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">3</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;(2 * 3)&#39;]
</pre></div>
</div>
</div>
</div>
<p>The idea is now to start with a depth of 0, subsequently increasing it as we proceed:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GrammarReducer</span><span class="p">(</span><span class="n">GrammarReducer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">reduce_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="n">max_height</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
            <span class="n">reduced</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reduce_subtree</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">reduced</span><span class="p">:</span>
                <span class="n">depth</span> <span class="o">=</span> <span class="mi">0</span>    <span class="c1"># Start with new tree</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">depth</span> <span class="o">+=</span> <span class="mi">1</span>   <span class="c1"># Extend search for subtrees</span>
        <span class="k">return</span> <span class="n">tree</span>        
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grammar_reducer</span> <span class="o">=</span> <span class="n">GrammarReducer</span><span class="p">(</span>
    <span class="n">mystery</span><span class="p">,</span>
    <span class="n">EarleyParser</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">),</span>
    <span class="n">log_test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">grammar_reducer</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">expr_input</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test #1 &#39;(2 * 3)&#39; 7 FAIL
Test #2 &#39;(3)&#39; 3 FAIL
Test #3 &#39;3&#39; 1 PASS
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;(3)&#39;
</pre></div>
</div>
</div>
</div>
<p>We see that a depth-oriented strategy needs even fewer steps in our setting.</p>
</section>
<section id="comparing-strategies">
<h3>Comparing Strategies<a class="headerlink" href="#comparing-strategies" title="Link to this heading">#</a></h3>
<p>We close by demonstrating the difference between text-based delta debugging and our grammar-based reduction.  We build a very long expression:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">GrammarFuzzer</span> <span class="kn">import</span> <span class="n">GrammarFuzzer</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">long_expr_input</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">,</span> <span class="n">min_nonterminals</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
<span class="n">long_expr_input</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;++---((-2 / 3 / 3 - -+1 / 5 - 2) * ++6 / +8 * 4 / 9 / 2 * 8 + ++(5) * 3 / 8 * 0 + 3 * 3 + 4 / 0 / 6 + 9) * ++++(+--9 * -3 * 7 / 4 + --(4) / 3 - 0 / 3 + 5 + 0) * (1 * 6 - 1 / 9 * 5 - 9 / 0 + 7) * ++(8 - 1) * +1 * 7 * 0 + ((1 + 4) / 4 * 8 * 9 * 4 + 4 / (4) * 1 - (4) * 8 * 5 + 1 + 4) / (+(2 - 1 - 9) * 5 + 3 + 6 - 2) * +3 * (3 - 7 + 8) / 4 - -(9 * 4 - 1 * 0 + 5) / (5 / 9 * 5 + 2) * 7 + ((7 - 5 + 3) / 1 * 8 - 8 - 9) * --+1 * 4 / 4 - 4 / 7 * 4 - 3 / 6 * 1 - 2 - 7 - 8&#39;
</pre></div>
</div>
</div>
</div>
<p>With grammars, we need only a handful of tests to find the failure-inducing input:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Timer</span> <span class="kn">import</span> <span class="n">Timer</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grammar_reducer</span> <span class="o">=</span> <span class="n">GrammarReducer</span><span class="p">(</span><span class="n">eval_mystery</span><span class="p">,</span> <span class="n">EarleyParser</span><span class="p">(</span><span class="n">EXPR_GRAMMAR</span><span class="p">))</span>
<span class="k">with</span> <span class="n">Timer</span><span class="p">()</span> <span class="k">as</span> <span class="n">grammar_time</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">grammar_reducer</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">long_expr_input</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(9)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grammar_reducer</span><span class="o">.</span><span class="n">tests</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grammar_time</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0751019999734126
</pre></div>
</div>
</div>
</div>
<p>Delta debugging, in contrast, requires orders of magnitude more tests (and consequently, time).  Again, the reduction is not closely as perfect as it is with the grammar-based reducer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd_reducer</span> <span class="o">=</span> <span class="n">DeltaDebuggingReducer</span><span class="p">(</span><span class="n">eval_mystery</span><span class="p">)</span>
<span class="k">with</span> <span class="n">Timer</span><span class="p">()</span> <span class="k">as</span> <span class="n">dd_time</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">dd_reducer</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">long_expr_input</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((2 - 1 - 2) * 8 + (5) - (4)) / ((2) * 3) * (9) / 3 / 1 - 8
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd_reducer</span><span class="o">.</span><span class="n">tests</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>900
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd_time</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.6051183340023272
</pre></div>
</div>
</div>
</div>
<p>We see that if an input is syntactically complex, using a grammar to reduce inputs is the best way to go.</p>
</section>
</section>
<section id="id1">
<h2>Synopsis<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<p>A <em>reducer</em> takes a failure-inducing input and reduces it to the minimum that still reproduces the failure.  This chapter provides <code class="docutils literal notranslate"><span class="pre">Reducer</span></code> classes that implement such reducers.</p>
<p>Here is a simple example: An arithmetic expression causes an error in the Python interpreter:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;x = 1 + 2 * 3 / 0&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;
ZeroDivisionError: division by zero
</pre></div>
</div>
</div>
</div>
<p>Can we reduce this input to a minimum?  To use a <code class="docutils literal notranslate"><span class="pre">Reducer</span></code>, one first has to build a <code class="docutils literal notranslate"><span class="pre">Runner</span></code> whose outcome is <code class="docutils literal notranslate"><span class="pre">FAIL</span></code> if the precise error occurs.  We therefore build a <code class="docutils literal notranslate"><span class="pre">ZeroDivisionRunner</span></code> whose <code class="docutils literal notranslate"><span class="pre">run()</span></code> method will specifically return a <code class="docutils literal notranslate"><span class="pre">FAIL</span></code> outcome if a <code class="docutils literal notranslate"><span class="pre">ZeroDivisionError</span></code> occurs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Fuzzer</span> <span class="kn">import</span> <span class="n">ProgramRunner</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ZeroDivisionRunner</span><span class="p">(</span><span class="n">ProgramRunner</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make outcome &#39;FAIL&#39; if ZeroDivisionError occurs&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inp</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">subprocess</span><span class="o">.</span><span class="n">CompletedProcess</span><span class="p">,</span> <span class="n">Outcome</span><span class="p">]:</span>
        <span class="n">process</span><span class="p">,</span> <span class="n">outcome</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;ZeroDivisionError&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">outcome</span> <span class="o">=</span> <span class="s1">&#39;FAIL&#39;</span>
        <span class="k">return</span> <span class="n">process</span><span class="p">,</span> <span class="n">outcome</span>
</pre></div>
</div>
</div>
</div>
<p>If we feed this expression into a <code class="docutils literal notranslate"><span class="pre">ZeroDivisionRunner</span></code>, it will produce an outcome of <code class="docutils literal notranslate"><span class="pre">FAIL</span></code> as designed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">python_input</span> <span class="o">=</span> <span class="s2">&quot;x = 1 + 2 * 3 / 0&quot;</span>
<span class="n">python_runner</span> <span class="o">=</span> <span class="n">ZeroDivisionRunner</span><span class="p">(</span><span class="s2">&quot;python&quot;</span><span class="p">)</span>
<span class="n">process</span><span class="p">,</span> <span class="n">outcome</span> <span class="o">=</span> <span class="n">python_runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">python_input</span><span class="p">)</span>
<span class="n">outcome</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;FAIL&#39;
</pre></div>
</div>
</div>
</div>
<p>Delta Debugging is a simple and robust reduction algorithm.  We can tie a <code class="docutils literal notranslate"><span class="pre">DeltaDebuggingReducer</span></code> to this runner, and have it determine the substring that causes the <code class="docutils literal notranslate"><span class="pre">python</span></code> program to fail:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dd</span> <span class="o">=</span> <span class="n">DeltaDebuggingReducer</span><span class="p">(</span><span class="n">python_runner</span><span class="p">)</span>
<span class="n">dd</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">python_input</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;3/0&#39;
</pre></div>
</div>
</div>
</div>
<p>The input is reduced to the minimum: We get the essence of the division by zero.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ignore</span>
<span class="kn">from</span> <span class="nn">ClassDiagram</span> <span class="kn">import</span> <span class="n">display_class_hierarchy</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ignore</span>
<span class="n">display_class_hierarchy</span><span class="p">([</span><span class="n">DeltaDebuggingReducer</span><span class="p">,</span> <span class="n">GrammarReducer</span><span class="p">],</span>
                        <span class="n">public_methods</span><span class="o">=</span><span class="p">[</span>
                            <span class="n">Reducer</span><span class="o">.</span><span class="fm">__init__</span><span class="p">,</span>
                            <span class="n">Reducer</span><span class="o">.</span><span class="n">reset</span><span class="p">,</span>
                            <span class="n">Reducer</span><span class="o">.</span><span class="n">reduce</span><span class="p">,</span>
                            <span class="n">DeltaDebuggingReducer</span><span class="o">.</span><span class="n">reduce</span><span class="p">,</span>
                            <span class="n">GrammarReducer</span><span class="o">.</span><span class="fm">__init__</span><span class="p">,</span>
                            <span class="n">GrammarReducer</span><span class="o">.</span><span class="n">reduce</span><span class="p">,</span>
                        <span class="p">],</span>
                        <span class="n">types</span><span class="o">=</span><span class="p">{</span>
                            <span class="s1">&#39;DerivationTree&#39;</span><span class="p">:</span> <span class="n">DerivationTree</span><span class="p">,</span>
                            <span class="s1">&#39;Grammar&#39;</span><span class="p">:</span> <span class="n">Grammar</span><span class="p">,</span>
                            <span class="s1">&#39;Outcome&#39;</span><span class="p">:</span> <span class="n">Outcome</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="n">project</span><span class="o">=</span><span class="s1">&#39;fuzzingbook&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Pages: 1 -->
<svg width="476pt" height="364pt"
 viewBox="0.00 0.00 475.50 363.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 359.5)">
<g id="a_graph0"><a xlink:title="DeltaDebuggingReducer class hierarchy">
<polygon fill="white" stroke="none" points="-4,4 -4,-359.5 471.5,-359.5 471.5,4 -4,4"/>
</a>
</g>
<!-- DeltaDebuggingReducer -->
<g id="node1" class="node">
<title>DeltaDebuggingReducer</title>
<g id="a_node1"><a xlink:href="#" xlink:title="class DeltaDebuggingReducer:&#10;Reduce inputs using delta debugging.">
<polygon fill="none" stroke="black" points="0,-45.12 0,-91.88 163.75,-91.88 163.75,-45.12 0,-45.12"/>
<text text-anchor="start" x="8" y="-75.58" font-family="Patua One, Helvetica, sans-serif" font-weight="bold" font-size="14.00" fill="#b03a2e">DeltaDebuggingReducer</text>
<polyline fill="none" stroke="black" points="0,-65.88 163.75,-65.88"/>
<g id="a_node1_0"><a xlink:href="#" xlink:title="DeltaDebuggingReducer">
<g id="a_node1_1"><a xlink:href="#" xlink:title="reduce(self, inp: str) &#45;&gt; str:&#10;Reduce input `inp` using delta debugging. Return reduced input.">
<text text-anchor="start" x="57.88" y="-53.38" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00">reduce()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- CachingReducer -->
<g id="node2" class="node">
<title>CachingReducer</title>
<g id="a_node2"><a xlink:href="#" xlink:title="class CachingReducer:&#10;A reducer that also caches test outcomes">
<polygon fill="none" stroke="black" points="111.38,-173.5 111.38,-233 226.38,-233 226.38,-173.5 111.38,-173.5"/>
<text text-anchor="start" x="119.38" y="-216.7" font-family="Patua One, Helvetica, sans-serif" font-weight="bold" font-size="14.00" fill="#b03a2e">CachingReducer</text>
<polyline fill="none" stroke="black" points="111.38,-207 226.38,-207"/>
<g id="a_node2_2"><a xlink:href="#" xlink:title="CachingReducer">
<g id="a_node2_3"><a xlink:href="#" xlink:title="reset(self):&#10;Reset the test counter to zero. To be extended in subclasses.">
<text text-anchor="start" x="147.88" y="-194.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">reset()</text>
</a>
</g>
<g id="a_node2_4"><a xlink:href="#" xlink:title="test(self, inp):&#10;Test with input `inp`. Return outcome.&#10;To be extended in subclasses.">
<text text-anchor="start" x="147.88" y="-181.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">test()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- DeltaDebuggingReducer&#45;&gt;CachingReducer -->
<g id="edge1" class="edge">
<title>DeltaDebuggingReducer&#45;&gt;CachingReducer</title>
<path fill="none" stroke="black" d="M96.83,-92.32C109.67,-111.91 128.45,-140.56 143.61,-163.7"/>
<polygon fill="none" stroke="black" points="140.62,-165.53 149.03,-171.97 146.48,-161.69 140.62,-165.53"/>
</g>
<!-- Reducer -->
<g id="node3" class="node">
<title>Reducer</title>
<g id="a_node3"><a xlink:href="#" xlink:title="class Reducer:&#10;Base class for reducers.">
<polygon fill="none" stroke="black" points="130.88,-270 130.88,-355 206.88,-355 206.88,-270 130.88,-270"/>
<text text-anchor="start" x="144.12" y="-338.7" font-family="Patua One, Helvetica, sans-serif" font-weight="bold" font-size="14.00" fill="#b03a2e">Reducer</text>
<polyline fill="none" stroke="black" points="130.88,-329 206.88,-329"/>
<g id="a_node3_5"><a xlink:href="#" xlink:title="Reducer">
<g id="a_node3_6"><a xlink:href="#" xlink:title="__init__(self, runner: Fuzzer.Runner, log_test: bool = False) &#45;&gt; None:&#10;Attach reducer to the given `runner`">
<text text-anchor="start" x="138.88" y="-316.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="10.00">__init__()</text>
</a>
</g>
<g id="a_node3_7"><a xlink:href="#" xlink:title="reduce(self, inp: str) &#45;&gt; str:&#10;Reduce input `inp`. Return reduced input.&#10;To be defined in subclasses.">
<text text-anchor="start" x="138.88" y="-303.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00">reduce()</text>
</a>
</g>
<g id="a_node3_8"><a xlink:href="#" xlink:title="reset(self) &#45;&gt; None:&#10;Reset the test counter to zero. To be extended in subclasses.">
<text text-anchor="start" x="138.88" y="-291" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00">reset()</text>
</a>
</g>
<g id="a_node3_9"><a xlink:href="#" xlink:title="test(self, inp: str) &#45;&gt; str:&#10;Test with input `inp`. Return outcome.&#10;To be extended in subclasses.">
<text text-anchor="start" x="138.88" y="-278.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="10.00">test()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- CachingReducer&#45;&gt;Reducer -->
<g id="edge2" class="edge">
<title>CachingReducer&#45;&gt;Reducer</title>
<path fill="none" stroke="black" d="M168.88,-233.27C168.88,-241.04 168.88,-249.68 168.88,-258.31"/>
<polygon fill="none" stroke="black" points="165.38,-258.05 168.88,-268.05 172.38,-258.05 165.38,-258.05"/>
</g>
<!-- GrammarReducer -->
<g id="node4" class="node">
<title>GrammarReducer</title>
<g id="a_node4"><a xlink:href="#" xlink:title="class GrammarReducer:&#10;Reduce inputs using grammars">
<polygon fill="none" stroke="black" points="181.88,-0.5 181.88,-136.5 329.88,-136.5 329.88,-0.5 181.88,-0.5"/>
<text text-anchor="start" x="201.88" y="-120.2" font-family="Patua One, Helvetica, sans-serif" font-weight="bold" font-size="14.00" fill="#b03a2e">GrammarReducer</text>
<polyline fill="none" stroke="black" points="181.88,-110.5 329.88,-110.5"/>
<g id="a_node4_10"><a xlink:href="#" xlink:title="GrammarReducer">
<g id="a_node4_11"><a xlink:href="#" xlink:title="__init__(self, runner: Fuzzer.Runner, parser: Parser.Parser, *, log_test: bool = False, log_reduce: bool = False):&#10;Constructor.&#10;`runner` is the runner to be used.&#10;`parser` is the parser to be used.&#10;`log_test` &#45; if set, show tests and results.&#10;`log_reduce` &#45; if set, show reduction steps.">
<text text-anchor="start" x="189.88" y="-98" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00">__init__()</text>
</a>
</g>
<g id="a_node4_12"><a xlink:href="#" xlink:title="reduce(self, inp):&#10;Reduce input `inp`. Return reduced input.&#10;To be defined in subclasses.">
<text text-anchor="start" x="189.88" y="-85.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-style="italic" font-size="10.00">reduce()</text>
</a>
</g>
<g id="a_node4_13"><a xlink:href="#" xlink:title="alternate_reductions(self, tree: DerivationTree, symbol: str, depth: int = &#45;1)">
<text text-anchor="start" x="189.88" y="-71.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">alternate_reductions()</text>
</a>
</g>
<g id="a_node4_14"><a xlink:href="#" xlink:title="parse(self, inp)">
<text text-anchor="start" x="189.88" y="-58.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">parse()</text>
</a>
</g>
<g id="a_node4_15"><a xlink:href="#" xlink:title="reduce_subtree(self, tree: DerivationTree, subtree: DerivationTree, depth: int = &#45;1)">
<text text-anchor="start" x="189.88" y="-46" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">reduce_subtree()</text>
</a>
</g>
<g id="a_node4_16"><a xlink:href="#" xlink:title="reduce_tree(self, tree)">
<text text-anchor="start" x="189.88" y="-33.25" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">reduce_tree()</text>
</a>
</g>
<g id="a_node4_17"><a xlink:href="#" xlink:title="subtrees_with_symbol(self, tree: DerivationTree, symbol: str, depth: int = &#45;1, ignore_root: bool = True) &#45;&gt; List[DerivationTree]:&#10;Find all subtrees in `tree` whose root is `symbol`.&#10;If `ignore_root` is true, ignore the root note of `tree`.">
<text text-anchor="start" x="189.88" y="-20.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">subtrees_with_symbol()</text>
</a>
</g>
<g id="a_node4_18"><a xlink:href="#" xlink:title="symbol_reductions(self, tree: DerivationTree, symbol: str, depth: int = &#45;1):&#10;Find all expansion alternatives for the given symbol">
<text text-anchor="start" x="189.88" y="-7.75" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="10.00">symbol_reductions()</text>
</a>
</g>
</a>
</g>
</a>
</g>
</g>
<!-- GrammarReducer&#45;&gt;CachingReducer -->
<g id="edge3" class="edge">
<title>GrammarReducer&#45;&gt;CachingReducer</title>
<path fill="none" stroke="black" d="M211.87,-136.65C205.81,-145.9 199.76,-155.12 194.2,-163.61"/>
<polygon fill="none" stroke="black" points="191.3,-161.64 188.75,-171.92 197.16,-165.48 191.3,-161.64"/>
</g>
<!-- Legend -->
<g id="node5" class="node">
<title>Legend</title>
<text text-anchor="start" x="348.25" y="-84.5" font-family="Patua One, Helvetica, sans-serif" font-weight="bold" font-size="10.00" fill="#b03a2e">Legend</text>
<text text-anchor="start" x="348.25" y="-74.5" font-family="Patua One, Helvetica, sans-serif" font-size="10.00">• </text>
<text text-anchor="start" x="354.25" y="-74.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-weight="bold" font-size="8.00">public_method()</text>
<text text-anchor="start" x="348.25" y="-64.5" font-family="Patua One, Helvetica, sans-serif" font-size="10.00">• </text>
<text text-anchor="start" x="354.25" y="-64.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-size="8.00">private_method()</text>
<text text-anchor="start" x="348.25" y="-54.5" font-family="Patua One, Helvetica, sans-serif" font-size="10.00">• </text>
<text text-anchor="start" x="354.25" y="-54.5" font-family="'Fira Mono', 'Source Code Pro', 'Courier', monospace" font-style="italic" font-size="8.00">overloaded_method()</text>
<text text-anchor="start" x="348.25" y="-45.45" font-family="Helvetica,sans-Serif" font-size="9.00">Hover over names to see doc</text>
</g>
</g>
</svg>
</div></div>
</div>
</section>
<section id="lessons-learned">
<h2>Lessons Learned<a class="headerlink" href="#lessons-learned" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Reducing failure-inducing inputs to a minimum is helpful for testing and debugging.</p></li>
<li><p><em>Delta debugging</em> is a simple and robust algorithm to easily reduce test cases.</p></li>
<li><p>For syntactically complex inputs, <em>grammar-based reduction</em> is much faster and yields better results.</p></li>
</ul>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Link to this heading">#</a></h2>
<p>Our next chapter focuses on <a class="reference internal" href="WebFuzzer.html"><span class="std std-doc">Web GUI Fuzzing</span></a>, another domain where generating and reducing test cases is central.</p>
</section>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Link to this heading">#</a></h2>
<p>The “lexical” delta debugging algorithm discussed here stems from \cite{Zeller2002}; actually, this is the exact Python implementation as used by Zeller in 2002.  The idea of systematically reducing inputs has been discovered a number of times, although not as automatic and generic as delta debugging. \cite{Slutz1998}, for instance, discusses systematic reduction of SQL statements for SQL databases; the general process as manual work is well described by \cite{Kernighan1999}.</p>
<p>The deficits of delta debugging as it comes to syntactically complex inputs were first discussed in <em>compiler testing</em>, and <em>reducing tree inputs</em> rather than string inputs was quickly discovered as an alternative.  <em>Hierarchical Delta Debugging</em> (<em>HDD</em>) \cite{Misherghi2006} applies delta debugging on subtrees of a parse tree, systematically reducing a parse tree to a minimum.  <em>Generalized Tree Reduction</em> \cite{Herfert2017} generalizes this idea to apply arbitrary <em>patterns</em> such as replacing a term by a compatible term in a subtree, as <code class="docutils literal notranslate"><span class="pre">subtrees_with_symbol()</span></code> does.  Using <em>grammars</em> to reduce inputs was first implemented in the <em>Perses</em> tool \cite{Sun2018}; our algorithm implements very similar strategies.  Searching for alternate expansions (as <code class="docutils literal notranslate"><span class="pre">alternate_reductions()</span></code>) is a contribution of the present chapter.</p>
<p>While applying delta debugging to code lines does a decent job, <em>syntactic</em> and especially <em>language-specific</em> approaches can do a much better job for the programming language at hand:</p>
<ul class="simple">
<li><p><em>C-Reduce</em> \cite{Regehr2012} is a reducer specifically targeting the reduction of programming languages.  Besides reductions in the style of delta debugging or tree transformations, C-Reduce comes with more than 30 source-to-source transformations that replace aggregates by scalars, remove function parameters at a definition and all call sites, change functions to return <code class="docutils literal notranslate"><span class="pre">void</span></code> and deleting all <code class="docutils literal notranslate"><span class="pre">return</span></code> statements, and many more.  While specifically instantiated for the C language (and used for testing C compilers), these principles extend to arbitrary programming languages following an ALGOL-like syntax.</p></li>
<li><p>Kalhauge and Palsberg \cite{Kalhauge2019} introduce <em>binary reduction of dependency graphs</em>, a general solution for reducing arbitrary inputs with dependencies. Their <em>J-Reduce</em> tool specifically targets Java programs, and again is much faster than delta debugging and achieves a higher reduction rate.</p></li>
</ul>
<p>Reducing inputs also works well in the context of <em>property-based testing</em>; that is, generating data structures for individual functions, which can then be reduced (“shrunk”) upon failure. The <a class="reference external" href="https://hypothesis.works">Hypothesis</a> fuzzer has a number of type-specific shrinking strategies; this <a class="reference external" href="https://hypothesis.works/articles/integrated-shrinking/">blog article</a> discusses some of its features.</p>
<p>The chapter on <a class="reference external" href="https://www.debuggingbook.org/html/DeltaDebugger.html">“Reducing Failure-Inducing Inputs” in the Debugging Book</a> has an alternate implementation <code class="docutils literal notranslate"><span class="pre">DeltaDebugger</span></code> of delta debugging that is even easier to deploy; here, one simply writes</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">DeltaDebugger</span><span class="p">()</span> <span class="k">as</span> <span class="n">dd</span><span class="p">:</span>
    <span class="n">fun</span><span class="p">(</span><span class="n">args</span><span class="o">...</span><span class="p">)</span>
<span class="n">dd</span>
</pre></div>
</div>
<p>to reduce the input in <code class="docutils literal notranslate"><span class="pre">args</span></code> for a failing (exception-throwing) function <code class="docutils literal notranslate"><span class="pre">fun()</span></code>. The chapter also  discusses further usage examples, including reducing <em>code</em> to a minimum.</p>
<p>This <a class="reference external" href="https://www.drmaciver.com/2019/01/notes-on-test-case-reduction/">blog post</a> by David McIver contains lots of insights on how to apply reduction in practice, in particular multiple runs with different abstraction levels.</p>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">#</a></h2>
<p>How to best reduce inputs is still an underdeveloped field of research, with lots of opportunities.</p>
<section id="exercise-1-mutation-based-fuzzing-with-reduction">
<h3>Exercise 1: Mutation-Based Fuzzing with Reduction<a class="headerlink" href="#exercise-1-mutation-based-fuzzing-with-reduction" title="Link to this heading">#</a></h3>
<p>When fuzzing with a population, it can be useful to occasionally <em>reduce</em> the length of each element, such that future descendants are shorter, too, which typically speeds up their testing.</p>
<p>Consider the <code class="docutils literal notranslate"><span class="pre">MutationFuzzer</span></code> class from <a class="reference internal" href="MutationFuzzer.html"><span class="std std-doc">the chapter on mutation-based fuzzing</span></a>.
Extend it such that whenever a new input is added to the population, it is first reduced using delta debugging.</p>
<p><strong>Solution.</strong> Left to the reader.</p>
</section>
<section id="exercise-2-reduction-by-production">
<h3>Exercise 2: Reduction by Production<a class="headerlink" href="#exercise-2-reduction-by-production" title="Link to this heading">#</a></h3>
<p>Grammar-based input reduction, as sketched above, might be a good algorithm, but is by no means the only alternative.  One interesting question is whether “reduction” should only be limited to elements already present, or whether one would be allowed to also create <em>new</em> elements.  These would not be present in the original input, yet still allow producing a much smaller input that would still reproduce the original failure.</p>
<p>As an example, consider the following grammar:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">number</span><span class="o">&gt;</span> <span class="p">:</span><span class="o">:=</span> <span class="o">&lt;</span><span class="nb">float</span><span class="o">&gt;</span> <span class="o">|</span> <span class="o">&lt;</span><span class="n">integer</span><span class="o">&gt;</span> <span class="o">|</span> <span class="o">&lt;</span><span class="ow">not</span><span class="o">-</span><span class="n">a</span><span class="o">-</span><span class="n">number</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nb">float</span><span class="o">&gt;</span> <span class="p">:</span><span class="o">:=</span> <span class="o">&lt;</span><span class="n">digits</span><span class="o">&gt;.&lt;</span><span class="n">digits</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">integer</span><span class="o">&gt;</span> <span class="p">:</span><span class="o">:=</span> <span class="o">&lt;</span><span class="n">digits</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="ow">not</span><span class="o">-</span><span class="n">a</span><span class="o">-</span><span class="n">number</span><span class="o">&gt;</span> <span class="p">:</span><span class="o">:=</span> <span class="n">NaN</span>
<span class="o">&lt;</span><span class="n">digits</span><span class="o">&gt;</span> <span class="p">:</span><span class="o">:=</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span>
</pre></div>
</div>
<p>Assume the input <code class="docutils literal notranslate"><span class="pre">100.99</span></code> fails.  We might be able to reduce it to a minimum of, say, <code class="docutils literal notranslate"><span class="pre">1.9</span></code>.  However, we cannot reduce it to an <code class="docutils literal notranslate"><span class="pre">&lt;integer&gt;</span></code> or to <code class="docutils literal notranslate"><span class="pre">&lt;not-a-number&gt;</span></code>, as these symbols do not occur in the original input.  By allowing to <em>create</em> alternatives for these symbols, we could also test inputs such as <code class="docutils literal notranslate"><span class="pre">1</span></code> or <code class="docutils literal notranslate"><span class="pre">NaN</span></code> and further generalize the class of inputs for which the program fails.</p>
<p>Create a class <code class="docutils literal notranslate"><span class="pre">GenerativeGrammarReducer</span></code> as subclass of <code class="docutils literal notranslate"><span class="pre">GrammarReducer</span></code>; extend the method <code class="docutils literal notranslate"><span class="pre">reduce_subtree()</span></code> accordingly.</p>
<p><strong>Solution.</strong> Left to the reader.</p>
</section>
<section id="exercise-3-the-big-reduction-shoot-out">
<h3>Exercise 3: The Big Reduction Shoot-Out<a class="headerlink" href="#exercise-3-the-big-reduction-shoot-out" title="Link to this heading">#</a></h3>
<p>Create a <em>benchmark</em> for the grammars already defined earlier, consisting of:</p>
<ol class="arabic simple">
<li><p>A set of <em>inputs</em>, produced from these very grammars using <code class="docutils literal notranslate"><span class="pre">GrammarFuzzer</span></code> and derivatives;</p></li>
<li><p>A set of <em>tests</em> which check for the occurrence of individual symbols as well as pairs and triples of these symbols:</p>
<ul class="simple">
<li><p>Tests should be <em>unresolved</em> if the input is not syntactically valid;</p></li>
<li><p>Tests should <em>fail</em> if the symbols (or pairs or triples thereof) occur;</p></li>
<li><p>Tests should <em>pass</em> in all other cases.</p></li>
</ul>
</li>
</ol>
<p>Compare delta debugging and grammar-based debugging on the benchmark.  Implement HDD \cite{Misherghi2006} and <em>Generalized Tree Reduction</em> \cite{Herfert2017} and add them to your comparison.  Which approach performs best, and under which circumstances?</p>
<p><strong>Solution.</strong> Left to the reader.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="GreyboxGrammarFuzzer.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Greybox Fuzzing with Grammars</p>
      </div>
    </a>
    <a class="right-next"
       href="FuzzingWithConstraints.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Fuzzing with Constraints</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synopsis">Synopsis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-reducing">Why Reducing?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-input-reduction">Manual Input Reduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#delta-debugging">Delta Debugging</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#grammar-based-input-reduction">Grammar-Based Input Reduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lexical-reduction-vs-syntactic-rules">Lexical Reduction vs. Syntactic Rules</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-grammar-based-reduction-approach">A Grammar-Based Reduction Approach</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simplifying-by-replacing-subtrees">Simplifying by Replacing Subtrees</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simplifying-by-alternative-expansions">Simplifying by Alternative Expansions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#excursion-a-class-for-reducing-with-grammars">Excursion: A Class for Reducing with Grammars</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#a-few-helpers">A Few Helpers</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#simplification-strategies">Simplification Strategies</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-subtrees">Finding Subtrees</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#alternate-expansions">Alternate Expansions</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#both-strategies-together">Both Strategies Together</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-reduction-strategy">The Reduction Strategy</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#end-of-excursion">End of Excursion</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-depth-oriented-strategy">A Depth-Oriented Strategy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-strategies">Comparing Strategies</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Synopsis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lessons-learned">Lessons Learned</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next Steps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-mutation-based-fuzzing-with-reduction">Exercise 1: Mutation-Based Fuzzing with Reduction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-reduction-by-production">Exercise 2: Reduction by Production</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-3-the-big-reduction-shoot-out">Exercise 3: The Big Reduction Shoot-Out</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Andreas Zeller, Rahul Gopinath, Marcel Böhme, Gordon Fraser, and Christian Holler
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2021-2025 CISPA Helmholtz Center for Information Security (www.cispa.de); © Copyright 2018-2020 Saarland University, authors, and contributors. All Rights Reserved.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>